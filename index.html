<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆìŒí¸ì§€ ğŸ’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Malgun Gothic", "ë§‘ì€ ê³ ë”•", "Apple SD Gothic Neo", sans-serif;
        }
        
        /* ê³„ì ˆë³„ ì—½ì„œ í…Œë§ˆ ìŠ¤íƒ€ì¼ */
        .season-spring {
            background: linear-gradient(135deg, #fce7f3, #f3e8ff, #ecfdf5);
            border: 5px solid #f9a8d4;
        }
        .season-spring .theme-icon { color: #ec4899; }
        .season-spring .recipient-sender-text { color: #be185d; }
        /* ë´„ ì¶”ê°€ ì¥ì‹ */
        .spring-decorations {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 24px;
            opacity: 0.7;
            z-index: 5;
        }

        .season-summer {
            background: linear-gradient(135deg, #dbeafe, #e0f2fe, #ecfeff);
            border: 5px solid #38bdf8;
        }
        .season-summer .theme-icon { color: #0284c7; }
        .season-summer .recipient-sender-text { color: #075985; }
        /* ì—¬ë¦„ ì¶”ê°€ ì¥ì‹ */
        .summer-decorations {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 28px;
            opacity: 0.6;
            z-index: 5;
        }

        .season-autumn {
            background: linear-gradient(135deg, #fed7aa, #fecaca, #fef3c7);
            border: 5px solid #fb923c;
        }
        .season-autumn .theme-icon { color: #ea580c; }
        .season-autumn .recipient-sender-text { color: #c2410c; }
        /* ê°€ì„ ì¶”ê°€ ì¥ì‹ */
        .autumn-decorations {
            position: absolute;
            bottom: 15px;
            right: 15px;
            font-size: 26px;
            opacity: 0.7;
            z-index: 5;
        }
        
        .season-winter {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0, #f8fafc);
            border: 5px solid #94a3b8;
        }
        .season-winter .theme-icon { color: #475569; }
        .season-winter .recipient-sender-text { color: #334155; }
        /* ê²¨ìš¸ ì¶”ê°€ ì¥ì‹ - CSS ì˜¤ë¥˜ ìˆ˜ì •ë¨ */
        .winter-decorations {
            position: absolute;
            top: 10px;
            right: 10px;
            left: 10px; /* ìˆ˜ì •: ê³µë°± ì¶”ê°€ */
            display: flex;
            justify-content: space-between;
            z-index: 5;
        }
        .winter-decorations span {
            font-size: 20px;
            opacity: 0.5;
        }
        
        /* ê³„ì ˆ ì„ íƒ ìƒíƒœ í‘œì‹œ */
        .season-option.selected {
            border-color: currentColor;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* ğŸŒ¸ ë´„ - ê½ƒì í©ë‚ ë¦¬ê¸° ì• ë‹ˆë©”ì´ì…˜ */
        .spring-petals {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .petal {
            position: absolute;
            width: 12px;
            height: 12px;
            background: radial-gradient(ellipse, #fce7f3, #f9a8d4);
            border-radius: 50% 0;
            opacity: 0.7;
            animation: petalFall linear infinite;
        }
        
        @keyframes petalFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            90% {
                opacity: 0.7;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* ğŸŒŠ ì—¬ë¦„ - íŒŒë„ ì• ë‹ˆë©”ì´ì…˜ */
        .summer-waves {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .wave {
            position: absolute;
            bottom: 0;
            left: -50%;
            width: 200%;
            height: 40px;
            background: linear-gradient(90deg, transparent, rgba(56, 189, 248, 0.3), transparent);
            border-radius: 50%;
            animation: waveMove linear infinite;
        }
        
        @keyframes waveMove {
            0% {
                transform: translateX(-50%) scaleY(1);
            }
            50% {
                transform: translateX(-25%) scaleY(1.2);
            }
            100% {
                transform: translateX(0%) scaleY(1);
            }
        }
        
        /* ğŸ‚ ê°€ì„ - ë‚™ì—½ ë–¨ì–´ì§€ê¸° ì• ë‹ˆë©”ì´ì…˜ */
        .autumn-leaves {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .leaf {
            position: absolute;
            font-size: 16px;
            opacity: 0.8;
            animation: leafFall linear infinite;
        }
        
        @keyframes leafFall {
            0% {
                transform: translateY(-50px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            90% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh) rotate(180deg);
                opacity: 0;
            }
        }
        
        /* â„ï¸ ê²¨ìš¸ - ëˆˆ ë‚´ë¦¬ê¸° ì• ë‹ˆë©”ì´ì…˜ */
        .winter-snow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .snowflake {
            position: absolute;
            color: white;
            font-size: 14px;
            opacity: 0.9;
            animation: snowFall linear infinite;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
        }
        
        @keyframes snowFall {
            0% {
                transform: translateY(-50px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.9;
            }
            90% {
                opacity: 0.9;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* ì—½ì„œ ì½˜í…ì¸ ëŠ” ì• ë‹ˆë©”ì´ì…˜ë³´ë‹¤ ìœ„ì— í‘œì‹œ */
        .postcard-content {
            position: relative;
            z-index: 10;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .postcard-text-layer {
            position: relative;
            z-index: 10;
        }
        
        .loading {
            pointer-events: none;
            opacity: 0.7;
        }
        
        /* ìŠ¤í¬ë¦° ë¦¬ë” ì „ìš© í…ìŠ¤íŠ¸ */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* ë§í¬ ë³µì‚¬ ì„±ê³µ ì•Œë¦¼ ì• ë‹ˆë©”ì´ì…˜ */
        .copy-success {
            animation: copySuccess 0.3s ease-in-out;
        }
        
        @keyframes copySuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        /* ë¯¸ë¦¬ë³´ê¸° ì „ìš© ëª¨ë“œ ìŠ¤íƒ€ì¼ */
        .preview-only-mode .input-section {
            display: none !important;
        }
        
        .preview-only-mode .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        .preview-only-mode .grid {
            grid-template-columns: 1fr;
            gap: 0;
        }
        
        .preview-only-mode .preview-section {
            margin: 0;
            padding: 1.5rem;
            background: transparent;
            box-shadow: none;
        }
        
        .preview-only-mode #postcardPreview {
            min-height: 400px;
            height: auto;
        }
        
        .preview-only-mode header {
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .preview-only-mode header h1 {
            font-size: 2rem;
        }
        
        .preview-only-mode footer {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #e2e8f0;
            text-align: center;
        }
        
        .preview-only-mode footer p {
            font-size: 0.75rem;
            color: #94a3b8;
        }
        
        /* ëª¨ë°”ì¼ì—ì„œ ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ ìµœì í™” */
        @media (max-width: 640px) {
            .preview-only-mode .container {
                max-width: 100%;
                padding: 1rem;
            }
            
            .preview-only-mode header h1 {
                font-size: 1.5rem;
            }
            
            .preview-only-mode .preview-section {
                padding: 1rem;
            }
            
            .preview-only-mode #postcardPreview {
                min-height: 350px;
                padding: 1rem;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-50 to-sky-100 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="container mx-auto max-w-4xl bg-white shadow-2xl rounded-xl p-4 sm:p-6 md:p-8">
        <header class="text-center mb-6 sm:mb-8">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-sky-500">ğŸ’ ë§ˆìŒí¸ì§€ ğŸ’</h1>
            <p class="text-slate-600 mt-2 sm:mt-3 text-sm md:text-base">ì†Œì¤‘í•œ ì‚¬ëŒì—ê²Œ ë§ˆìŒì„ ë‹´ì•„ ê³„ì ˆì˜ ì•„ë¦„ë‹¤ì›€ê³¼ í•¨ê»˜ ì„¸ìƒì— í•˜ë‚˜ë¿ì¸ í¸ì§€ë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 md:gap-8">
            <div class="input-section bg-slate-50 p-4 sm:p-6 rounded-lg shadow-md">
                <div class="mb-6 sm:mb-8">
                    <h2 class="text-lg sm:text-xl font-semibold text-slate-700 mb-4">ğŸŒˆ ê³„ì ˆ í…Œë§ˆë¥¼ ì„ íƒí•´ë³´ì„¸ìš”!</h2>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                        <button id="seasonSpring" class="season-option flex flex-col items-center p-3 rounded-xl border-2 border-transparent hover:border-pink-400 transition-all duration-200 bg-pink-100" data-season="spring">
                            <span class="text-3xl mb-1">ğŸŒ¸</span>
                            <span class="text-sm font-medium text-pink-700">ë´„</span>
                            <span class="text-xs text-pink-600">ê½ƒì í©ë‚ ë¦¼</span>
                        </button>
                        <button id="seasonSummer" class="season-option flex flex-col items-center p-3 rounded-xl border-2 border-transparent hover:border-blue-400 transition-all duration-200 bg-blue-100" data-season="summer">
                            <span class="text-3xl mb-1">ğŸŒŠ</span>
                            <span class="text-sm font-medium text-blue-700">ì—¬ë¦„</span>
                            <span class="text-xs text-blue-600">íŒŒë„ ì›€ì§ì„</span>
                        </button>
                        <button id="seasonAutumn" class="season-option flex flex-col items-center p-3 rounded-xl border-2 border-transparent hover:border-orange-400 transition-all duration-200 bg-orange-100" data-season="autumn">
                            <span class="text-3xl mb-1">ğŸ‚</span>
                            <span class="text-sm font-medium text-orange-700">ê°€ì„</span>
                            <span class="text-xs text-orange-600">ë‚™ì—½ ë–¨ì–´ì§</span>
                        </button>
                        <button id="seasonWinter" class="season-option flex flex-col items-center p-3 rounded-xl border-2 border-transparent hover:border-gray-400 transition-all duration-200 bg-gray-100" data-season="winter">
                            <span class="text-3xl mb-1">â„ï¸</span>
                            <span class="text-sm font-medium text-gray-700">ê²¨ìš¸</span>
                            <span class="text-xs text-gray-600">ëˆˆ ë‚´ë¦¼</span>
                        </button>
                    </div>
                </div>

                <h3 class="text-xl sm:text-2xl font-semibold text-slate-700 mb-4 sm:mb-6">âœï¸ í¸ì§€ ë‚´ìš© ì…ë ¥í•˜ê¸°</h3>
                <div class="space-y-4">
                    <div>
                        <label for="recipient" class="block text-sm font-medium text-slate-700">ğŸ’Œ ë°›ëŠ” ì‚¬ëŒ:</label>
                        <input type="text" id="recipient" name="recipient" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="ì˜ˆ: ì‚¬ë‘í•˜ëŠ” ì¹œêµ¬ì—ê²Œ">
                    </div>
                    <div>
                        <label for="sender" class="block text-sm font-medium text-slate-700">âœï¸ ë³´ë‚´ëŠ” ì‚¬ëŒ:</label>
                        <input type="text" id="sender" name="sender" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="ì˜ˆ: ê·€ì—¼ë‘¥ì´ OOO ì˜¬ë¦¼">
                    </div>
                    <div>
                        <label for="message" class="block text-sm font-medium text-slate-700">ğŸ’• ë§ˆìŒì˜ ë©”ì‹œì§€:</label>
                        <textarea id="message" name="message" rows="5" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="ì†Œì¤‘í•œ ì‚¬ëŒì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë”°ëœ»í•œ ë§ˆìŒì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”."></textarea>
                    </div>
                    <div>
                        <label for="promise" class="block text-sm font-medium text-slate-700">ğŸ¤ ì†Œì¤‘í•œ ì‚¬ëŒì„ ìœ„í•´ ë‚´ê°€ ê¼­ ì‹¤ì²œí•  ì•½ì†:</label>
                        <textarea id="promise" name="promise" rows="3" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="ì˜ˆ: ë” ìì£¼ ì•ˆë¶€ë¥¼ ë¬¼ì–´ë³´ê³ , ë”°ëœ»í•œ ë§ ê±´ë„¤ê¸°"></textarea>
                    </div>
                    <div>
                        <label for="date" class="block text-sm font-medium text-slate-700">ğŸ“… ì‘ì„± ë‚ ì§œ:</label>
                        <input type="date" id="date" name="date" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm">
                    </div>
                </div>

                <div class="mt-6 sm:mt-8 space-y-3">
                    <button id="updatePreview" class="w-full flex items-center justify-center bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-md shadow transition-colors duration-150 text-sm sm:text-base">
                        <span class="mr-2 text-lg">ğŸ¨</span>í¸ì§€ í™•ì¸í•˜ê¸°
                    </button>
                    
                    <button id="downloadImageBtn" class="w-full flex items-center justify-center bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-md shadow transition-colors duration-150 text-sm sm:text-base">
                        <span class="mr-2 text-lg">ğŸ“¸</span>í¸ì§€ ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ê¸°
                    </button>
                    
                    <button id="copyLinkBtn" class="w-full flex items-center justify-center bg-purple-500 hover:bg-purple-600 text-white font-bold py-3 px-4 rounded-md shadow transition-colors duration-150 text-sm sm:text-base">
                        <span class="mr-2 text-lg">ğŸ”—</span>ë§ˆìŒí¸ì§€ ë§í¬ ë³µì‚¬
                    </button>
                    
                    <button id="copyContent" class="w-full flex items-center justify-center bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-md shadow transition-colors duration-150 text-sm sm:text-base">
                        <span class="mr-2 text-lg">ğŸ“‹</span>í¸ì§€ ë‚´ìš© ì „ì²´ ë³µì‚¬
                    </button>
                    
                    <button id="resetForm" class="w-full flex items-center justify-center bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-md shadow transition-colors duration-150 text-sm sm:text-base">
                        <span class="mr-2 text-lg">ğŸ”„</span>ìƒˆë¡œ ì“°ê¸°
                    </button>
                </div>
                
                <div id="status-messages" aria-live="polite" aria-atomic="true" class="sr-only"></div>
            </div>

            <div class="preview-section bg-slate-50 p-4 sm:p-6 rounded-lg shadow-md flex flex-col">
                <h2 class="text-xl sm:text-2xl font-semibold text-slate-700 mb-4 sm:mb-6 text-center">âœ¨ ì™„ì„±ëœ í¸ì§€ ë¯¸ë¦¬ë³´ê¸° âœ¨</h2>
                <div id="postcardPreview" class="season-spring w-full min-h-[400px] sm:min-h-[500px] p-4 sm:p-6 rounded-lg shadow-inner flex flex-col transition-all duration-300 ease-in-out relative overflow-hidden">
                    
                    <!-- ê³„ì ˆë³„ ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ ì˜ì—­ë“¤ -->
                    <div id="springPetals" class="spring-petals"></div>
                    <div id="summerWaves" class="summer-waves" style="display: none;"></div>
                    <div id="autumnLeaves" class="autumn-leaves" style="display: none;"></div>
                    <div id="winterSnow" class="winter-snow" style="display: none;"></div>

                    <!-- ê³„ì ˆë³„ ì •ì  ì¥ì‹ ìš”ì†Œë“¤ -->
                    <div id="seasonalDecorations" class="absolute inset-0 pointer-events-none z-5">
                        <div class="spring-decorations" style="display:none;">ğŸŒ¸ğŸŒ¿</div>
                        <div class="summer-decorations" style="display:none;">â˜€ï¸ğŸš</div>
                        <div class="autumn-decorations" style="display:none;">ğŸ„ğŸŒ°</div>
                        <div class="winter-decorations" style="display:none;">
                            <span>âœ¨</span>
                            <span>â­</span>
                        </div>
                    </div>
                    
                    <!-- í…ìŠ¤íŠ¸ ë ˆì´ì–´ (ì• ë‹ˆë©”ì´ì…˜ ìœ„ì— í‘œì‹œ) -->
                    <div class="postcard-text-layer flex flex-col h-full">
                        <div class="absolute top-2 right-2 sm:top-4 sm:right-4 text-2xl sm:text-4xl theme-icon" id="previewThemeIcon">ğŸŒ¸</div>
                        
                        <div class="mb-4">
                            <p class="text-sm sm:text-base recipient-sender-text">To. <span id="previewRecipient" class="font-semibold postcard-content">ë°›ëŠ” ì‚¬ëŒ ì´ë¦„</span></p>
                        </div>
                        
                        <div class="text-center flex-grow py-2 px-1 relative">
                            <p id="previewMessage" class="text-slate-800 leading-relaxed postcard-content mb-3 sm:mb-4">ë”°ëœ»í•œ ë§ˆìŒì˜ ë©”ì‹œì§€ë¥¼ ì—¬ê¸°ì— ì ì–´ì£¼ì„¸ìš”...</p>
                            <p id="previewPromise" class="text-indigo-600 font-medium postcard-content mb-2"></p>
                        </div>
                        
                        <div class="mt-4 text-right">
                            <p class="text-sm sm:text-base recipient-sender-text">From. <span id="previewSender" class="font-semibold postcard-content">ë³´ë‚´ëŠ” ì‚¬ëŒ ì´ë¦„</span></p>
                            <p id="previewDate" class="text-xs text-slate-500 mt-1 postcard-content">ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                        </div>
                    </div>
                </div>
                
                <!-- ì‚¬ìš© ë°©ë²• -->
                <div class="mt-4 sm:mt-6 p-3 sm:p-4 bg-blue-50 border-l-4 border-blue-400 text-blue-700 rounded-md shadow">
                    <p class="font-semibold text-sm sm:text-base mb-2 sm:mb-3">ğŸ“ ì‚¬ìš© ë°©ë²•</p>
                    <div class="space-y-1.5 sm:space-y-2 text-xs sm:text-sm">
                        <div class="flex items-center">
                            <span class="mr-2">ğŸŒ¸</span>
                            <strong>ê³„ì ˆ ì„ íƒ:</strong> ë´„, ì—¬ë¦„, ê°€ì„, ê²¨ìš¸ ì¤‘ ì›í•˜ëŠ” ê³„ì ˆ íš¨ê³¼ë¥¼ ì„ íƒí•˜ì„¸ìš”.
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2">âœï¸</span>
                            <strong>ë‚´ìš© ì…ë ¥:</strong> ë°›ëŠ” ì‚¬ëŒ, ë©”ì‹œì§€ ë“±ì„ ì ìœ¼ë©´ ì‹¤ì‹œê°„ìœ¼ë¡œ ë¯¸ë¦¬ë³´ê¸°ì— ë°˜ì˜ë¼ìš”!
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2">ğŸ¨</span>
                            <strong>ë¯¸ë¦¬ë³´ê¸° í™•ì¸:</strong> 'ì—½ì„œ í™•ì¸í•˜ê¸°' ë²„íŠ¼ìœ¼ë¡œë„ ì—…ë°ì´íŠ¸ ê°€ëŠ¥í•´ìš”.
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2">ğŸ”—</span>
                            <strong>ë§í¬ ê³µìœ :</strong> 'ë§ˆìŒí¸ì§€ ë§í¬ ë³µì‚¬'ë¡œ í¸ì§€ë§Œ ê¹”ë”í•˜ê²Œ ë³´ì´ëŠ” ë§í¬ë¥¼ ìƒì„±í•´ìš”!
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2">ğŸ“¸</span>
                            <strong>ì´ë¯¸ì§€ ì €ì¥:</strong> ì™„ì„±ëœ ì—½ì„œë¥¼ ì´ë¯¸ì§€ íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”. (ì• ë‹ˆë©”ì´ì…˜ì€ í˜„ì¬ ë³´ì´ëŠ” ì¥ë©´ìœ¼ë¡œ ì €ì¥)
                        </div>
                    </div>
                    <div class="mt-3 p-2 bg-blue-100 rounded-md">
                        <p class="text-xs font-medium text-blue-800">
                            âœ¨ <strong>íŠ¹ë³„í•œ ê¸°ëŠ¥:</strong> ê° ê³„ì ˆë§ˆë‹¤ ê³ ìœ í•œ ë°°ê²½ ì• ë‹ˆë©”ì´ì…˜ê³¼ ì¶”ê°€ ì¥ì‹ì´ í…ìŠ¤íŠ¸ ë’¤ì—ì„œ ë¶€ë“œëŸ½ê²Œ ì›€ì§ì´ê±°ë‚˜ í‘œì‹œë©ë‹ˆë‹¤!
                        </p>
                    </div>
                    <div class="mt-2 p-2 bg-purple-100 rounded-md">
                        <p class="text-xs font-medium text-purple-800">
                            ğŸ”— <strong>ë§í¬ ê³µìœ  íŒ:</strong> 'ë§ˆìŒí¸ì§€ ë§í¬ ë³µì‚¬' ë²„íŠ¼ìœ¼ë¡œ ìƒì„±ëœ ë§í¬ë¥¼ ê³µìœ í•˜ë©´, ë°›ëŠ” ì‚¬ëŒì€ í¸ì§€ ë‚´ìš©ê³¼ ì•„ë¦„ë‹¤ìš´ ê³„ì ˆ ì• ë‹ˆë©”ì´ì…˜ë§Œ ê¹”ë”í•˜ê²Œ ë³¼ ìˆ˜ ìˆì–´ìš”!
                        </p>
                    </div>
                    <p class="text-xs mt-2 sm:mt-3 text-blue-600">
                        ğŸ’¡ <strong>íŒ:</strong> ì €ì¥ëœ ì´ë¯¸ì§€ëŠ” íŒ¨ë“¤ë ›ì´ë‚˜ í´ë˜ìŠ¤íŒ…ì— ë°”ë¡œ ì˜¬ë¦´ ìˆ˜ ìˆì–´ìš”!
                    </p>
                </div>
            </div>
        </div>
        
        <footer class="text-center mt-8 sm:mt-10 pt-4 sm:pt-6 border-t border-slate-200">
            <p class="text-xs sm:text-sm text-slate-500">
                ë§Œë“ ì´ : ë£°ë£¨ë„ë¼ í•œê¸°ìŒ¤ ğŸ“ | 
                <a href="https://www.facebook.com/playrurulala" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:text-blue-800 underline">
                    í˜ì´ìŠ¤ë¶ ğŸ‘¥
                </a>
            </p>
        </footer>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let currentSeason = 'spring';
        let animationIntervals = [];
        let updateTimeoutId = null; // ë””ë°”ìš´ìŠ¤ìš©
        
        const recipientInput = document.getElementById('recipient');
        const senderInput = document.getElementById('sender');
        const messageInput = document.getElementById('message');
        const promiseInput = document.getElementById('promise');
        const dateInput = document.getElementById('date');

        const postcardPreview = document.getElementById('postcardPreview');
        const previewRecipient = document.getElementById('previewRecipient');
        const previewSender = document.getElementById('previewSender');
        const previewMessage = document.getElementById('previewMessage');
        const previewPromise = document.getElementById('previewPromise');
        const previewDate = document.getElementById('previewDate');
        const previewThemeIcon = document.getElementById('previewThemeIcon');

        const seasonSpringButton = document.getElementById('seasonSpring');
        const seasonSummerButton = document.getElementById('seasonSummer');
        const seasonAutumnButton = document.getElementById('seasonAutumn');
        const seasonWinterButton = document.getElementById('seasonWinter');
        
        const updatePreviewButton = document.getElementById('updatePreview');
        const downloadImageBtn = document.getElementById('downloadImageBtn');
        const copyLinkBtn = document.getElementById('copyLinkBtn');
        const copyContentButton = document.getElementById('copyContent');
        const resetFormButton = document.getElementById('resetForm');
        const statusMessages = document.getElementById('status-messages');

        const springPetals = document.getElementById('springPetals');
        const summerWaves = document.getElementById('summerWaves');
        const autumnLeaves = document.getElementById('autumnLeaves');
        const winterSnow = document.getElementById('winterSnow');
        const seasonalDecorations = document.getElementById('seasonalDecorations');

        // ì ‘ê·¼ì„± - ìŠ¤í¬ë¦° ë¦¬ë”ì— ë©”ì‹œì§€ ì „ë‹¬
        function announceToScreenReader(message) {
            statusMessages.textContent = message;
            setTimeout(() => {
                statusMessages.textContent = '';
            }, 1000);
        }

        // ğŸ”— URL ë§¤ê°œë³€ìˆ˜ì—ì„œ ì—½ì„œ ë°ì´í„° ë¡œë“œ
        function loadPostcardFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            
            // ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ í™•ì¸
            const isPreviewMode = urlParams.has('preview');
            if (isPreviewMode) {
                document.body.classList.add('preview-only-mode');
                // í˜ì´ì§€ ì œëª© ë³€ê²½
                document.title = 'ê³µìœ ë°›ì€ ë§ˆìŒí¸ì§€ ğŸ’Œ';
                // ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œì—ì„œëŠ” ì‚¬ìš© ë°©ë²• ì•ˆë‚´ ìˆ¨ê¸°ê¸°
                const usageSection = document.querySelector('.mt-4.sm\\:mt-6.p-3');
                if (usageSection) {
                    usageSection.style.display = 'none';
                }
                // ì œëª©ì„ "ê³µìœ ë°›ì€ ë§ˆìŒí¸ì§€"ë¡œ ë³€ê²½
                const mainTitle = document.querySelector('h1');
                if (mainTitle) {
                    mainTitle.textContent = 'ğŸ’Œ ê³µìœ ë°›ì€ ë§ˆìŒí¸ì§€ ğŸ’Œ';
                }
                // ì„¤ëª… í…ìŠ¤íŠ¸ ë³€ê²½
                const description = document.querySelector('.text-slate-600');
                if (description) {
                    description.textContent = 'ëˆ„êµ°ê°€ ë‹¹ì‹ ì—ê²Œ ë§ˆìŒì„ ë‹´ì•„ ë³´ë‚¸ íŠ¹ë³„í•œ í¸ì§€ì…ë‹ˆë‹¤! ğŸ';
                }
                // ë¯¸ë¦¬ë³´ê¸° ì œëª© ë³€ê²½
                const previewTitle = document.querySelector('.preview-section h2');
                if (previewTitle) {
                    previewTitle.textContent = 'ğŸ’ ë°›ì€ ë§ˆìŒí¸ì§€ ğŸ’';
                }
            }
            
            if (urlParams.has('postcard')) {
                try {
                    const encodedData = urlParams.get('postcard');
                    const decodedData = decodeURIComponent(encodedData);
                    const postcardData = JSON.parse(decodedData);
                    
                    if (postcardData.recipient) recipientInput.value = postcardData.recipient;
                    if (postcardData.sender) senderInput.value = postcardData.sender;
                    if (postcardData.message) messageInput.value = postcardData.message;
                    if (postcardData.promise) promiseInput.value = postcardData.promise;
                    if (postcardData.date) dateInput.value = postcardData.date;
                    if (postcardData.season) {
                        applySeason(postcardData.season);
                    }
                    
                    updatePostcardPreview();
                    announceToScreenReader('ê³µìœ ëœ í¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
                    
                    // URLì—ì„œ ë§¤ê°œë³€ìˆ˜ ì œê±° (ê¹”ë”í•˜ê²Œ)
                    if (!isPreviewMode) {
                        window.history.replaceState({}, document.title, window.location.pathname);
                    }
                    
                } catch (error) {
                    console.error('í¸ì§€ ë°ì´í„° ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', error);
                }
            }
        }

        // ğŸ”— í˜„ì¬ ì—½ì„œ ìƒíƒœë¥¼ URLë¡œ ì¸ì½”ë”©í•˜ì—¬ ë§í¬ ìƒì„±
        function generatePostcardLink() {
            const postcardData = {
                recipient: recipientInput.value,
                sender: senderInput.value,
                message: messageInput.value,
                promise: promiseInput.value,
                date: dateInput.value,
                season: currentSeason
            };
            
            const encodedData = encodeURIComponent(JSON.stringify(postcardData));
            const currentURL = window.location.origin + window.location.pathname;
            return `${currentURL}?postcard=${encodedData}&preview=true`;
        }

        // ğŸ”— ë§í¬ ë³µì‚¬ ê¸°ëŠ¥
        async function copyPostcardLink() {
            const originalText = copyLinkBtn.innerHTML;
            copyLinkBtn.innerHTML = '<span class="mr-2">â³</span>ë§í¬ ìƒì„± ì¤‘...';
            copyLinkBtn.disabled = true;
            
            try {
                if (!recipientInput.value && !senderInput.value && !messageInput.value) {
                    alert('í¸ì§€ ë‚´ìš©ì„ ì…ë ¥í•œ í›„ ë§í¬ë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”! ğŸ˜Š');
                    return;
                }
                
                const shareableLink = generatePostcardLink();
                await navigator.clipboard.writeText(shareableLink);
                
                copyLinkBtn.innerHTML = '<span class="mr-2">âœ…</span>ë§í¬ ë³µì‚¬ ì™„ë£Œ!';
                copyLinkBtn.classList.add('copy-success');
                
                alert(`ğŸ‰ ë§ˆìŒí¸ì§€ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆì–´ìš”!\n\nì´ ë§í¬ë¥¼ ì¹œêµ¬ë‚˜ ê°€ì¡±ì—ê²Œ ë³´ë‚´ë©´ ì•„ë¦„ë‹¤ìš´ ê³„ì ˆ ì• ë‹ˆë©”ì´ì…˜ê³¼ í•¨ê»˜ í¸ì§€ë§Œ ê¹”ë”í•˜ê²Œ ë³¼ ìˆ˜ ìˆì–´ìš”.\n\nğŸ’¡ ì¹´ì¹´ì˜¤í†¡, ë¬¸ì, ì´ë©”ì¼ ë“± ì–´ë””ë“  ë¶™ì—¬ë„£ê¸°(Ctrl+V ë˜ëŠ” Cmd+V) í•˜ì„¸ìš”!`);
                announceToScreenReader('í¸ì§€ ë§í¬ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                
                setTimeout(() => {
                    copyLinkBtn.classList.remove('copy-success');
                }, 300);
                
            } catch (error) {
                console.error('ë§í¬ ë³µì‚¬ ì‹¤íŒ¨:', error);
                alert('ë§í¬ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆì–´ìš”. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•˜ê±°ë‚˜ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
            } finally {
                setTimeout(() => {
                    copyLinkBtn.innerHTML = originalText;
                    copyLinkBtn.disabled = false;
                }, 2000);
            }
        }

        // ëª¨ë“  ì• ë‹ˆë©”ì´ì…˜ ì •ë¦¬
        function clearAllAnimations() {
            animationIntervals.forEach(interval => clearInterval(interval));
            animationIntervals = [];
            
            springPetals.innerHTML = '';
            summerWaves.innerHTML = '';
            autumnLeaves.innerHTML = '';
            winterSnow.innerHTML = '';
            
            springPetals.style.display = 'none';
            summerWaves.style.display = 'none';
            autumnLeaves.style.display = 'none';
            winterSnow.style.display = 'none';
            
            // ì¶”ê°€ ì¥ì‹ ìˆ¨ê¸°ê¸°
            document.querySelector('.spring-decorations').style.display = 'none';
            document.querySelector('.summer-decorations').style.display = 'none';
            document.querySelector('.autumn-decorations').style.display = 'none';
            document.querySelector('.winter-decorations').style.display = 'none';
        }

        // ğŸŒ¸ ë´„ - ê½ƒì í©ë‚ ë¦¬ê¸° ì• ë‹ˆë©”ì´ì…˜
        function startSpringAnimation() {
            clearAllAnimations();
            springPetals.style.display = 'block';
            document.querySelector('.spring-decorations').style.display = 'block';
            
            const createPetal = () => {
                const petal = document.createElement('div');
                petal.className = 'petal';
                petal.style.left = Math.random() * 100 + '%';
                petal.style.animationDuration = (Math.random() * 3 + 4) + 's';
                petal.style.animationDelay = Math.random() * 2 + 's';
                springPetals.appendChild(petal);
                
                setTimeout(() => {
                    if (petal.parentNode) {
                        petal.parentNode.removeChild(petal);
                    }
                }, 7000);
            };
            
            // ì´ˆê¸° ê½ƒìë“¤ ìƒì„±
            for (let i = 0; i < 6; i++) {
                setTimeout(createPetal, i * 500);
            }
            
            // ì§€ì†ì ìœ¼ë¡œ ê½ƒì ìƒì„±
            const interval = setInterval(createPetal, 1500);
            animationIntervals.push(interval);
        }

        // ğŸŒŠ ì—¬ë¦„ - íŒŒë„ ì• ë‹ˆë©”ì´ì…˜
        function startSummerAnimation() {
            clearAllAnimations();
            summerWaves.style.display = 'block';
            document.querySelector('.summer-decorations').style.display = 'block';
            
            const createWave = (delay) => {
                const wave = document.createElement('div');
                wave.className = 'wave';
                wave.style.animationDuration = '4s';
                wave.style.animationDelay = delay + 's';
                summerWaves.appendChild(wave);
            };
            
            // ì—¬ëŸ¬ ê°œì˜ íŒŒë„ ìƒì„±
            createWave(0);
            createWave(1);
            createWave(2);
        }

        // ğŸ‚ ê°€ì„ - ë‚™ì—½ ë–¨ì–´ì§€ê¸° ì• ë‹ˆë©”ì´ì…˜
        function startAutumnAnimation() {
            clearAllAnimations();
            autumnLeaves.style.display = 'block';
            document.querySelector('.autumn-decorations').style.display = 'block';
            
            const leafEmojis = ['ğŸ‚', 'ğŸ'];
            const leafColors = ['#ea580c', '#dc2626', '#ca8a04'];
            
            const createLeaf = () => {
                const leaf = document.createElement('div');
                leaf.className = 'leaf';
                const leafType = Math.random();
                
                if (leafType < 0.7) {
                    leaf.textContent = leafEmojis[Math.floor(Math.random() * leafEmojis.length)];
                } else {
                    leaf.innerHTML = 'â—';
                    leaf.style.color = leafColors[Math.floor(Math.random() * leafColors.length)];
                    leaf.style.fontSize = '12px';
                }
                
                leaf.style.left = Math.random() * 100 + '%';
                leaf.style.animationDuration = (Math.random() * 3 + 5) + 's';
                leaf.style.animationDelay = Math.random() * 2 + 's';
                autumnLeaves.appendChild(leaf);
                
                setTimeout(() => {
                    if (leaf.parentNode) {
                        leaf.parentNode.removeChild(leaf);
                    }
                }, 8000);
            };
            
            // ì´ˆê¸° ë‚™ì—½ë“¤ ìƒì„±
            for (let i = 0; i < 5; i++) {
                setTimeout(createLeaf, i * 600);
            }
            
            // ì§€ì†ì ìœ¼ë¡œ ë‚™ì—½ ìƒì„±
            const interval = setInterval(createLeaf, 2000);
            animationIntervals.push(interval);
        }

        // â„ï¸ ê²¨ìš¸ - ëˆˆ ë‚´ë¦¬ê¸° ì• ë‹ˆë©”ì´ì…˜
        function startWinterAnimation() {
            clearAllAnimations();
            winterSnow.style.display = 'block';
            document.querySelector('.winter-decorations').style.display = 'flex'; // ê²¨ìš¸ ì¥ì‹ì€ flexë¡œ í‘œì‹œ
            
            const snowflakeChars = ['â„', 'â…', 'âœ¦', 'âœ§', 'â—¦'];
            
            const createSnowflake = () => {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.textContent = snowflakeChars[Math.floor(Math.random() * snowflakeChars.length)];
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.fontSize = (Math.random() * 6 + 10) + 'px';
                snowflake.style.animationDuration = (Math.random() * 4 + 6) + 's';
                snowflake.style.animationDelay = Math.random() * 2 + 's';
                winterSnow.appendChild(snowflake);
                
                setTimeout(() => {
                    if (snowflake.parentNode) {
                        snowflake.parentNode.removeChild(snowflake);
                    }
                }, 10000);
            };
            
            // ì´ˆê¸° ëˆˆì†¡ì´ë“¤ ìƒì„±
            for (let i = 0; i < 8; i++) {
                setTimeout(createSnowflake, i * 400);
            }
            
            // ì§€ì†ì ìœ¼ë¡œ ëˆˆì†¡ì´ ìƒì„±
            const interval = setInterval(createSnowflake, 1200);
            animationIntervals.push(interval);
        }

        // ê³„ì ˆ í…Œë§ˆ ì ìš©
        function applySeason(season) {
            currentSeason = season;
            
            const seasonConfigs = {
                spring: {
                    class: 'season-spring',
                    icon: 'ğŸŒ¸',
                    textClass: 'text-pink-700',
                    animation: startSpringAnimation
                },
                summer: {
                    class: 'season-summer',
                    icon: 'ğŸŒŠ',
                    textClass: 'text-blue-700',
                    animation: startSummerAnimation
                },
                autumn: {
                    class: 'season-autumn',
                    icon: 'ğŸ‚',
                    textClass: 'text-orange-700',
                    animation: startAutumnAnimation
                },
                winter: {
                    class: 'season-winter',
                    icon: 'â„ï¸',
                    textClass: 'text-gray-700',
                    animation: startWinterAnimation
                }
            };
            
            // ê¸°ì¡´ ê³„ì ˆ í´ë˜ìŠ¤ ì œê±°
            postcardPreview.classList.remove('season-spring', 'season-summer', 'season-autumn', 'season-winter');
            
            const config = seasonConfigs[season];
            postcardPreview.classList.add(config.class);
            previewThemeIcon.textContent = config.icon;
            
            // í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            const textElements = postcardPreview.querySelectorAll('.recipient-sender-text');
            textElements.forEach(el => {
                el.classList.remove('text-pink-700', 'text-blue-700', 'text-orange-700', 'text-gray-700');
                el.classList.add(config.textClass);
            });
            
            // ê³„ì ˆ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.season-option').forEach(btn => btn.classList.remove('selected'));
            document.querySelector(`[data-season="${season}"]`).classList.add('selected');
            
            // ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
            config.animation();
            
            announceToScreenReader(`${config.icon} ${season} í…Œë§ˆê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        function setTodayDate() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            dateInput.value = `${yyyy}-${mm}-${dd}`;
        }

        // ë””ë°”ìš´ìŠ¤ëœ ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸ (ì„±ëŠ¥ ìµœì í™”)
        function debouncedUpdatePreview() {
            if (updateTimeoutId) {
                clearTimeout(updateTimeoutId);
            }
            updateTimeoutId = setTimeout(updatePostcardPreview, 300); // 300ms ëŒ€ê¸°
        }

        function updatePostcardPreview() {
            previewRecipient.textContent = recipientInput.value || 'ë°›ëŠ” ì‚¬ëŒ ì´ë¦„';
            previewSender.textContent = senderInput.value || 'ë³´ë‚´ëŠ” ì‚¬ëŒ ì´ë¦„';
            previewMessage.textContent = messageInput.value || 'ë”°ëœ»í•œ ë§ˆìŒì˜ ë©”ì‹œì§€ë¥¼ ì—¬ê¸°ì— ì ì–´ì£¼ì„¸ìš”...';
            previewPromise.textContent = promiseInput.value ? `ğŸ’ ì‹¤ì²œ ì•½ì†: ${promiseInput.value}` : '';
            
            const dateValue = dateInput.value;
            if (dateValue) {
                const [year, month, day] = dateValue.split('-');
                previewDate.textContent = `${year}ë…„ ${month}ì›” ${day}ì¼`;
            } else {
                previewDate.textContent = 'ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”';
            }
            
            adjustTextSizeBasedOnContent();
        }

        function adjustTextSizeBasedOnContent() {
            const messageLength = messageInput.value.length;
            const promiseLength = promiseInput.value.length;
            const isMobile = window.innerWidth < 640;
            
            previewMessage.classList.remove('text-lg', 'text-base', 'text-sm', 'text-xs');
            if (isMobile) {
                if (messageLength > 150) {
                    previewMessage.classList.add('text-xs');
                } else if (messageLength > 80) {
                    previewMessage.classList.add('text-sm');
                } else if (messageLength > 40) {
                    previewMessage.classList.add('text-base');
                } else {
                    previewMessage.classList.add('text-base');
                }
            } else {
                if (messageLength > 200) {
                    previewMessage.classList.add('text-xs');
                } else if (messageLength > 120) {
                    previewMessage.classList.add('text-sm');
                } else if (messageLength > 60) {
                    previewMessage.classList.add('text-base');
                } else {
                    previewMessage.classList.add('text-lg');
                }
            }
            
            previewPromise.classList.remove('text-base', 'text-sm', 'text-xs');
            if (isMobile) {
                if (promiseLength > 60) {
                    previewPromise.classList.add('text-xs');
                } else if (promiseLength > 30) {
                    previewPromise.classList.add('text-sm');
                } else {
                    previewPromise.classList.add('text-sm');
                }
            } else {
                if (promiseLength > 100) {
                    previewPromise.classList.add('text-xs');
                } else if (promiseLength > 50) {
                    previewPromise.classList.add('text-sm');
                } else {
                    previewPromise.classList.add('text-base');
                }
            }
        }

        // ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥
        async function downloadPostcardAsImage() {
            const originalText = downloadImageBtn.innerHTML;
            downloadImageBtn.innerHTML = '<span class="mr-2">â³</span>ì´ë¯¸ì§€ ìƒì„± ì¤‘...';
            downloadImageBtn.disabled = true;
            downloadImageBtn.classList.add('loading');
            
                            announceToScreenReader('í¸ì§€ ì´ë¯¸ì§€ ìƒì„±ì„ ì‹œì‘í•©ë‹ˆë‹¤.');
            
            try {
                if (typeof html2canvas === 'undefined') {
                    throw new Error('ì´ë¯¸ì§€ ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
                
                updatePostcardPreview(); // ìµœì¢… ë‚´ìš© ë°˜ì˜
                await new Promise(resolve => setTimeout(resolve, 500)); // ì• ë‹ˆë©”ì´ì…˜ ë° DOM ì—…ë°ì´íŠ¸ ëŒ€ê¸°
                
                if (!postcardPreview || postcardPreview.offsetWidth === 0) {
                    throw new Error('í¸ì§€ë¥¼ ë¨¼ì € í™•ì¸í•´ì£¼ì„¸ìš”. ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }

                const canvas = await html2canvas(postcardPreview, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: false,
                    logging: false,
                    backgroundColor: null, // ë°°ê²½ì€ CSSì—ì„œ ì²˜ë¦¬
                    width: postcardPreview.offsetWidth,
                    height: postcardPreview.offsetHeight,
                    scrollX: 0,
                    scrollY: 0,
                    letterRendering: true,
                    imageTimeout: 15000,
                    removeContainer: true,
                    onclone: function(clonedDoc) {
                        const srOnlyElements = clonedDoc.querySelectorAll('.sr-only');
                        srOnlyElements.forEach(el => el.remove());
                        
                        const clonedPreview = clonedDoc.getElementById('postcardPreview');
                        if (clonedPreview) {
                            clonedPreview.style.height = 'auto';
                            clonedPreview.style.minHeight = postcardPreview.offsetHeight + 'px';
                            clonedPreview.style.overflow = 'visible';
                            clonedPreview.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Malgun Gothic", "ë§‘ì€ ê³ ë”•", "Apple SD Gothic Neo", sans-serif';
                            
                            const allElements = clonedPreview.querySelectorAll('*');
                            allElements.forEach(el => {
                                el.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Malgun Gothic", "ë§‘ì€ ê³ ë”•", "Apple SD Gothic Neo", sans-serif';
                            });
                        }
                        return clonedDoc;
                    }
                });

                if (canvas.width === 0 || canvas.height === 0) {
                    throw new Error('ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤ (ìº”ë²„ìŠ¤ í¬ê¸° 0).');
                }
                
                const imgData = canvas.toDataURL('image/png', 1.0);
                if (imgData === 'data:,' || imgData.length < 100) {
                    throw new Error('ì´ë¯¸ì§€ ë°ì´í„° ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
                const recipientName = recipientInput.value || 'ì†Œì¤‘í•œì‚¬ëŒ';
                const fileName = `${recipientName.replace(/[^\wê°€-í£ã„±-ã…ã…-ã…£ä¸€-é¾ ã-ã‚”ã‚¡-ãƒ´ãƒ¼]/g, '_')}_ë§ˆìŒí¸ì§€_${currentSeason}.png`;
                
                const downloadLink = document.createElement('a');
                downloadLink.href = imgData;
                downloadLink.download = fileName;
                downloadLink.style.display = 'none';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                announceToScreenReader('í¸ì§€ ì´ë¯¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                alert(`ğŸ‰ ${currentSeason} í…Œë§ˆ ë§ˆìŒí¸ì§€ ì´ë¯¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nì• ë‹ˆë©”ì´ì…˜ì˜ í˜„ì¬ ëª¨ìŠµê³¼ í•¨ê»˜ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë˜ì—ˆì–´ìš”.`);
                
            } catch (error) {
                console.error("ì´ë¯¸ì§€ ìƒì„± ì˜¤ë¥˜:", error);
                let errorMessage = "ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n" + error.message;
                alert(errorMessage);
                announceToScreenReader('ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                downloadImageBtn.innerHTML = originalText;
                downloadImageBtn.disabled = false;
                downloadImageBtn.classList.remove('loading');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        setTodayDate();

        // ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸° ì ìš© (ë””ë°”ìš´ìŠ¤ ì ìš©)
        [recipientInput, senderInput, messageInput, promiseInput, dateInput].forEach(input => {
            input.addEventListener('input', debouncedUpdatePreview);
        });
        
        updatePreviewButton.addEventListener('click', () => {
            updatePostcardPreview();
                            announceToScreenReader('í¸ì§€ ë‚´ìš©ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.'); // ë²„íŠ¼ í´ë¦­ ì‹œì—ëŠ” ì•ˆë‚´
        });
        
        downloadImageBtn.addEventListener('click', downloadPostcardAsImage);
        copyLinkBtn.addEventListener('click', copyPostcardLink);
        
        // ê³„ì ˆ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        seasonSpringButton.addEventListener('click', () => applySeason('spring'));
        seasonSummerButton.addEventListener('click', () => applySeason('summer'));
        seasonAutumnButton.addEventListener('click', () => applySeason('autumn'));
        seasonWinterButton.addEventListener('click', () => applySeason('winter'));

        copyContentButton.addEventListener('click', () => {
            const dateValue = dateInput.value;
            let formattedDate = 'ë‚ ì§œ ë¯¸ì§€ì •';
            if (dateValue) {
                const [year, month, day] = dateValue.split('-');
                formattedDate = `${year}ë…„ ${month}ì›” ${day}ì¼`;
            }

            const seasonNames = {
                spring: 'ë´„ (ê½ƒì í©ë‚ ë¦¼)',
                summer: 'ì—¬ë¦„ (íŒŒë„ ì›€ì§ì„)',
                autumn: 'ê°€ì„ (ë‚™ì—½ ë–¨ì–´ì§)',
                winter: 'ê²¨ìš¸ (ëˆˆ ë‚´ë¦¼)'
            };

            const contentToCopy = `
ë§ˆìŒí¸ì§€ ğŸ’
--------------------
ë°›ëŠ” ì‚¬ëŒ: ${recipientInput.value}
ë³´ë‚´ëŠ” ì‚¬ëŒ: ${senderInput.value}
ì‘ì„± ë‚ ì§œ: ${formattedDate}
ì„ íƒí•œ ê³„ì ˆ: ${seasonNames[currentSeason]}

[ë§ˆìŒì˜ ë©”ì‹œì§€]
${messageInput.value}

[ì†Œì¤‘í•œ ì‚¬ëŒì„ ìœ„í•œ ë‚˜ì˜ ì•½ì†]
${promiseInput.value}
--------------------
`.trim();

            navigator.clipboard.writeText(contentToCopy)
                .then(() => {
                    alert('ì—½ì„œ ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆì–´ìš”!');
                    announceToScreenReader('ì—½ì„œ ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                })
                .catch(err => {
                    console.error('ë³µì‚¬ ì‹¤íŒ¨: ', err);
                    alert('ì•—! ë‚´ìš© ë³µì‚¬ì— ì‹¤íŒ¨í–ˆì–´ìš”.');
                });
        });

        resetFormButton.addEventListener('click', () => {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ë‚´ìš©ì„ ì§€ìš°ê³  ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‘ì„±í• ê¹Œìš”?')) {
                recipientInput.value = '';
                senderInput.value = '';
                messageInput.value = '';
                promiseInput.value = '';
                setTodayDate();
                applySeason('spring');
                updatePostcardPreview();
                alert('ëª¨ë“  ë‚´ìš©ì´ ì§€ì›Œì¡Œì–´ìš”. ìƒˆë¡œìš´ ë§ˆìŒìœ¼ë¡œ ë§ˆìŒí¸ì§€ë¥¼ ë‹¤ì‹œ ì‘ì„±í•´ë³´ì„¸ìš”! ğŸ˜Š');
                announceToScreenReader('ì–‘ì‹ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        });

        // ì´ˆê¸° ì„¤ì •
        applySeason('spring'); // ì´ˆê¸° í…Œë§ˆ ì ìš©
        loadPostcardFromURL(); // URLì—ì„œ ë°ì´í„° ë¡œë“œ ì‹œë„
        updatePostcardPreview(); // ì´ˆê¸° ë¯¸ë¦¬ë³´ê¸° ì—…ë°ì´íŠ¸
        
        window.addEventListener('resize', adjustTextSizeBasedOnContent);
        window.addEventListener('beforeunload', clearAllAnimations);
        
        // ë¯¸ë¦¬ë³´ê¸° ëª¨ë“œ í™•ì¸í•˜ì—¬ ì ì ˆí•œ ë©”ì‹œì§€ ì¶œë ¥
        const urlParams = new URLSearchParams(window.location.search);
        const isPreviewMode = urlParams.has('preview');
        announceToScreenReader(isPreviewMode ? 'ê³µìœ ë°›ì€ ë§ˆìŒí¸ì§€ í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ë§ˆìŒí¸ì§€ ì„œë¹„ìŠ¤ í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
    </script>
</body>
</html>
