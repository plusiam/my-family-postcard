<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ ê°€ì¡± ì‚¬ë‘ ì—½ì„œ ë§Œë“¤ê¸° ğŸ’–</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Malgun Gothic", "ë§‘ì€ ê³ ë”•", "Apple SD Gothic Neo", sans-serif;
        }
        
        /* ì—½ì„œ í…Œë§ˆë³„ ìŠ¤íƒ€ì¼ í™•ì¥ */
        .theme-sky {
            background-color: #e0f2fe;
            border: 5px solid #7dd3fc;
        }
        .theme-sky .theme-icon { color: #0ea5e9; }
        .theme-sky .recipient-sender-text { color: #0369a1; }

        .theme-pink {
            background-color: #fce7f3;
            border: 5px solid #f9a8d4;
        }
        .theme-pink .theme-icon { color: #ec4899; }
        .theme-pink .recipient-sender-text { color: #be185d; }

        .theme-sunshine {
            background-color: #fef9c3;
            border: 5px solid #fde047;
        }
        .theme-sunshine .theme-icon { color: #f59e0b; }
        .theme-sunshine .recipient-sender-text { color: #b45309; }
        
        .theme-forest {
            background-color: #f0fdf4;
            border: 5px solid #86efac;
        }
        .theme-forest .theme-icon { color: #16a34a; }
        .theme-forest .recipient-sender-text { color: #15803d; }
        
        .theme-ocean {
            background-color: #ecfeff;
            border: 5px solid #67e8f9;
        }
        .theme-ocean .theme-icon { color: #0891b2; }
        .theme-ocean .recipient-sender-text { color: #0e7490; }
        
        .theme-sunset {
            background: linear-gradient(135deg, #fed7d7, #fbb6ce, #d6f5d6);
            border: 5px solid #f687b3;
        }
        .theme-sunset .theme-icon { color: #d53f8c; }
        .theme-sunset .recipient-sender-text { color: #97266d; }
        
        /* í…Œë§ˆ ì„ íƒ ìƒíƒœ í‘œì‹œ */
        .theme-option.selected {
            border-color: currentColor;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .postcard-content {
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .loading {
            pointer-events: none;
            opacity: 0.7;
        }
        
        /* ìŠ¤í¬ë¦° ë¦¬ë” ì „ìš© í…ìŠ¤íŠ¸ */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-50 to-sky-100 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="container mx-auto max-w-4xl bg-white shadow-2xl rounded-xl p-4 sm:p-6 md:p-8">
        <header class="text-center mb-6 sm:mb-8">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-sky-500">ğŸ’– ë‚˜ë§Œì˜ ê°€ì¡± ì‚¬ë‘ ì—½ì„œ ğŸ’–</h1>
            <p class="text-slate-600 mt-2 sm:mt-3 text-sm md:text-base">ì†Œì¤‘í•œ ê°€ì¡±ì—ê²Œ ì‚¬ë‘í•˜ëŠ” ë§ˆìŒì„ ë‹´ì•„ ì„¸ìƒì— í•˜ë‚˜ë¿ì¸ ì—½ì„œë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 md:gap-8">
            <div class="bg-slate-50 p-4 sm:p-6 rounded-lg shadow-md">
                <!-- ğŸ†• í…Œë§ˆ ì„ íƒì„ ë§¨ ìœ„ë¡œ ì´ë™ -->
                <div class="mb-6 sm:mb-8">
                    <h2 class="text-lg sm:text-xl font-semibold text-slate-700 mb-4">ğŸ¨ ì—½ì„œ í…Œë§ˆ ë¨¼ì € ê³¨ë¼ë³´ì„¸ìš”!</h2>
                    <div class="grid grid-cols-3 sm:grid-cols-6 gap-3">
                        <button id="themeSky" class="theme-option flex flex-col items-center p-3 rounded-xl border-2 border-transparent hover:border-sky-400 transition-all duration-200 bg-sky-100" data-theme="sky">
                            <span class="text-2xl mb-1">â˜ï¸</span>
                            <span class="text-xs font-medium text-sky-700">í•˜ëŠ˜</span>
                        </button>
                        <button id="themePink" class="theme-option flex flex-col items-center p-3 rounded-xl border-2 border-transparent hover:border-pink-400 transition-all duration-200 bg-pink-100" data-theme="pink">
                            <span class="text-2xl mb-1">ğŸ’–</span>
                            <span class="text-xs font-medium text-pink-700">í•‘í¬</span>
                        </button>
                        <button id="themeSunshine" class="theme-option flex flex-col items-center p-3 rounded-xl border-2 border-transparent hover:border-yellow-400 transition-all duration-200 bg-yellow-100" data-theme="sunshine">
                            <span class="text-2xl mb-1">â˜€ï¸</span>
                            <span class="text-xs font-medium text-yellow-700">í–‡ì‚´</span>
                        </button>
                        <button id="themeForest" class="theme-option flex flex-col items-center p-3 rounded-xl border-2 border-transparent hover:border-green-400 transition-all duration-200 bg-green-100" data-theme="forest">
                            <span class="text-2xl mb-1">ğŸŒ³</span>
                            <span class="text-xs font-medium text-green-700">ìˆ²ì†</span>
                        </button>
                        <button id="themeOcean" class="theme-option flex flex-col items-center p-3 rounded-xl border-2 border-transparent hover:border-cyan-400 transition-all duration-200 bg-cyan-100" data-theme="ocean">
                            <span class="text-2xl mb-1">ğŸŒŠ</span>
                            <span class="text-xs font-medium text-cyan-700">ë°”ë‹¤</span>
                        </button>
                        <button id="themeSunset" class="theme-option flex flex-col items-center p-3 rounded-xl border-2 border-transparent hover:border-purple-400 transition-all duration-200 bg-purple-100" data-theme="sunset">
                            <span class="text-2xl mb-1">ğŸŒ…</span>
                            <span class="text-xs font-medium text-purple-700">ì„ì–‘</span>
                        </button>
                    </div>
                </div>

                <h3 class="text-xl sm:text-2xl font-semibold text-slate-700 mb-4 sm:mb-6">âœï¸ ì—½ì„œ ë‚´ìš© ì…ë ¥í•˜ê¸°</h3>
                <div class="space-y-4">
                    <div>
                        <label for="recipient" class="block text-sm font-medium text-slate-700">ğŸ’Œ ë°›ëŠ” ì‚¬ëŒ:</label>
                        <input type="text" id="recipient" name="recipient" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="ì˜ˆ: ì‚¬ë‘í•˜ëŠ” ì—„ë§ˆ ì•„ë¹ ê»˜">
                    </div>
                    <div>
                        <label for="sender" class="block text-sm font-medium text-slate-700">âœï¸ ë³´ë‚´ëŠ” ì‚¬ëŒ:</label>
                        <input type="text" id="sender" name="sender" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="ì˜ˆ: ê·€ì—¼ë‘¥ì´ OOO ì˜¬ë¦¼">
                    </div>
                    <div>
                        <label for="message" class="block text-sm font-medium text-slate-700">ğŸ’• ì‚¬ë‘ì˜ ë©”ì‹œì§€:</label>
                        <textarea id="message" name="message" rows="5" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="ê°€ì¡±ì—ê²Œ ì „í•˜ê³  ì‹¶ì€ ë”°ëœ»í•œ ë§ˆìŒì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”."></textarea>
                    </div>
                    <div>
                        <label for="promise" class="block text-sm font-medium text-slate-700">ğŸ¤ ê°€ì¡±ì„ ìœ„í•´ ë‚´ê°€ ê¼­ ì‹¤ì²œí•  ì•½ì†:</label>
                        <textarea id="promise" name="promise" rows="3" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="ì˜ˆ: ë¶€ëª¨ë‹˜ ë§ì”€ ì˜ ë“£ê³ , ë™ìƒê³¼ ì‚¬ì´ì¢‹ê²Œ ì§€ë‚´ê¸°"></textarea>
                    </div>
                    <div>
                        <label for="date" class="block text-sm font-medium text-slate-700">ğŸ“… ì‘ì„± ë‚ ì§œ:</label>
                        <input type="date" id="date" name="date" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm">
                    </div>
                </div>

                <div class="mt-6 sm:mt-8 space-y-3">
                    <button id="updatePreview" class="w-full flex items-center justify-center bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-md shadow transition-colors duration-150 text-sm sm:text-base"><span class="mr-2 text-lg">ğŸ¨</span>ì—½ì„œ í™•ì¸í•˜ê¸°</button>
                    
                    <!-- ğŸ†• ìƒˆë¡œìš´ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
                    <button id="downloadImageBtn" class="w-full flex items-center justify-center bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-md shadow transition-colors duration-150 text-sm sm:text-base">
                        <span class="mr-2 text-lg">ğŸ“¸</span>ì—½ì„œ ì´ë¯¸ì§€ë¡œ ì €ì¥í•˜ê¸°
                    </button>
                    
                    <button id="copyContent" class="w-full flex items-center justify-center bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-md shadow transition-colors duration-150 text-sm sm:text-base"><span class="mr-2 text-lg">ğŸ“‹</span>ë‚´ìš© ì „ì²´ ë³µì‚¬</button>
                    <button id="resetForm" class="w-full flex items-center justify-center bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-md shadow transition-colors duration-150 text-sm sm:text-base"><span class="mr-2 text-lg">ğŸ”„</span>ìƒˆë¡œ ì“°ê¸°</button>
                </div>
                
                <!-- ìƒíƒœ ë©”ì‹œì§€ ì˜ì—­ -->
                <div id="status-messages" aria-live="polite" aria-atomic="true" class="sr-only"></div>
            </div>

            <div class="bg-slate-50 p-4 sm:p-6 rounded-lg shadow-md flex flex-col">
                <h2 class="text-xl sm:text-2xl font-semibold text-slate-700 mb-4 sm:mb-6 text-center">âœ¨ ì™„ì„±ëœ ì—½ì„œ ë¯¸ë¦¬ë³´ê¸° âœ¨</h2>
                <div id="postcardPreview" class="theme-sky w-full min-h-[400px] sm:min-h-[500px] p-4 sm:p-6 rounded-lg shadow-inner flex flex-col transition-all duration-300 ease-in-out relative">
                    <div class="absolute top-2 right-2 sm:top-4 sm:right-4 text-2xl sm:text-4xl theme-icon" id="previewThemeIcon">â˜ï¸</div>
                    
                    <div class="mb-4">
                        <p class="text-sm sm:text-base recipient-sender-text">To. <span id="previewRecipient" class="font-semibold postcard-content">ë°›ëŠ” ì‚¬ëŒ ì´ë¦„</span></p>
                    </div>
                    
                    <div class="text-center flex-grow py-2 px-1">
                        <p id="previewMessage" class="text-slate-800 leading-relaxed postcard-content mb-3 sm:mb-4">ë”°ëœ»í•œ ì‚¬ë‘ì˜ ë©”ì‹œì§€ë¥¼ ì—¬ê¸°ì— ì ì–´ì£¼ì„¸ìš”...</p>
                        <p id="previewPromise" class="text-indigo-600 font-medium postcard-content"></p>
                    </div>
                    
                    <div class="mt-4 text-right">
                        <p class="text-sm sm:text-base recipient-sender-text">From. <span id="previewSender" class="font-semibold postcard-content">ë³´ë‚´ëŠ” ì‚¬ëŒ ì´ë¦„</span></p>
                        <p id="previewDate" class="text-xs text-slate-500 mt-1 postcard-content">ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</p>
                    </div>
                </div>
                
                <!-- ğŸ†• ê° ë²„íŠ¼ ê¸°ëŠ¥ ê°„ë‹¨ ì„¤ëª… -->
                <div class="mt-4 sm:mt-6 p-3 sm:p-4 bg-blue-50 border-l-4 border-blue-400 text-blue-700 rounded-md shadow">
                    <p class="font-semibold text-sm sm:text-base mb-2 sm:mb-3">ğŸ“ ì‚¬ìš© ë°©ë²•</p>
                    <div class="space-y-1.5 sm:space-y-2 text-xs sm:text-sm">
                        <div class="flex items-center">
                            <span class="mr-2">1ï¸âƒ£</span>
                            <strong>í…Œë§ˆ ì„ íƒ:</strong> ìœ„ì—ì„œ ë§ˆìŒì— ë“œëŠ” ì—½ì„œ ë°°ê²½ì„ ë¨¼ì € ê³¨ë¼ì£¼ì„¸ìš”
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2">2ï¸âƒ£</span>
                            <strong>ë‚´ìš© ì…ë ¥:</strong> ë°›ëŠ” ì‚¬ëŒ, ë³´ë‚´ëŠ” ì‚¬ëŒ, ì‚¬ë‘ì˜ ë©”ì‹œì§€ë¥¼ ì ì–´ì£¼ì„¸ìš”
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2">3ï¸âƒ£</span>
                            <strong>ì—½ì„œ í™•ì¸:</strong> ğŸ¨ ë²„íŠ¼ìœ¼ë¡œ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ì—…ë°ì´íŠ¸í•˜ì„¸ìš”
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2">4ï¸âƒ£</span>
                            <strong>ì €ì¥í•˜ê¸°:</strong> ğŸ“¸ ë²„íŠ¼ìœ¼ë¡œ ì´ë¯¸ì§€ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”
                        </div>
                    </div>
                    <p class="text-xs mt-2 sm:mt-3 text-blue-600">
                        ğŸ’¡ <strong>íŒ:</strong> ì €ì¥ëœ ì´ë¯¸ì§€ëŠ” íŒ¨ë“¤ë ›ì´ë‚˜ í´ë˜ìŠ¤íŒ…ì— ë°”ë¡œ ì˜¬ë¦´ ìˆ˜ ìˆì–´ìš”!
                    </p>
                </div>
            </div>
        </div>
        
        <footer class="text-center mt-8 sm:mt-10 pt-4 sm:pt-6 border-t border-slate-200">
            <p class="text-xs sm:text-sm text-slate-500">ìŠ¤ë§ˆíŠ¸í¼ë¹Œë”ê°€ ì •ì„±ê» ë§Œë“¤ì–´ ë“œë ¸ì–´ìš”! ğŸ¤– | ì‹œìŠ¤í…œ í°íŠ¸ + Tailwind CSS + html2canvas</p>
        </footer>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        const recipientInput = document.getElementById('recipient');
        const senderInput = document.getElementById('sender');
        const messageInput = document.getElementById('message');
        const promiseInput = document.getElementById('promise');
        const dateInput = document.getElementById('date');

        const postcardPreview = document.getElementById('postcardPreview');
        const previewRecipient = document.getElementById('previewRecipient');
        const previewSender = document.getElementById('previewSender');
        const previewMessage = document.getElementById('previewMessage');
        const previewPromise = document.getElementById('previewPromise');
        const previewDate = document.getElementById('previewDate');
        const previewThemeIcon = document.getElementById('previewThemeIcon');

        const themeSkyButton = document.getElementById('themeSky');
        const themePinkButton = document.getElementById('themePink');
        const themeSunshineButton = document.getElementById('themeSunshine');
        const themeForestButton = document.getElementById('themeForest');
        const themeOceanButton = document.getElementById('themeOcean');
        const themeSunsetButton = document.getElementById('themeSunset');
        
        const updatePreviewButton = document.getElementById('updatePreview');
        const downloadImageBtn = document.getElementById('downloadImageBtn');
        const copyContentButton = document.getElementById('copyContent');
        const resetFormButton = document.getElementById('resetForm');
        const statusMessages = document.getElementById('status-messages');

        // ì ‘ê·¼ì„± - ìŠ¤í¬ë¦° ë¦¬ë”ì— ë©”ì‹œì§€ ì „ë‹¬
        function announceToScreenReader(message) {
            statusMessages.textContent = message;
            setTimeout(() => {
                statusMessages.textContent = '';
            }, 1000);
        }

        function setTodayDate() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            dateInput.value = `${yyyy}-${mm}-${dd}`;
        }

        function updatePostcardPreview() {
            previewRecipient.textContent = recipientInput.value || 'ë°›ëŠ” ì‚¬ëŒ ì´ë¦„';
            previewSender.textContent = senderInput.value || 'ë³´ë‚´ëŠ” ì‚¬ëŒ ì´ë¦„';
            previewMessage.textContent = messageInput.value || 'ë”°ëœ»í•œ ì‚¬ë‘ì˜ ë©”ì‹œì§€ë¥¼ ì—¬ê¸°ì— ì ì–´ì£¼ì„¸ìš”...';
            previewPromise.textContent = promiseInput.value ? `ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ ì‹¤ì²œ ì•½ì†: ${promiseInput.value}` : '';
            
            const dateValue = dateInput.value;
            if (dateValue) {
                const [year, month, day] = dateValue.split('-');
                previewDate.textContent = `${year}ë…„ ${month}ì›” ${day}ì¼`;
            } else {
                previewDate.textContent = 'ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”';
            }
            
            // ğŸ†• ë™ì  í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì •
            adjustTextSizeBasedOnContent();
            announceToScreenReader('ì—½ì„œ ë‚´ìš©ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ğŸ†• ëª¨ë°”ì¼/ë°ìŠ¤í¬í†± ê³ ë ¤í•œ í…ìŠ¤íŠ¸ í¬ê¸° ìë™ ì¡°ì •
        function adjustTextSizeBasedOnContent() {
            const messageLength = messageInput.value.length;
            const promiseLength = promiseInput.value.length;
            const isMobile = window.innerWidth < 640; // sm ë¸Œë ˆì´í¬í¬ì¸íŠ¸
            
            // ë©”ì‹œì§€ í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì • (ëª¨ë°”ì¼ì—ì„œëŠ” ë” ì‘ì€ ê¸°ì¤€ ì ìš©)
            previewMessage.classList.remove('text-lg', 'text-base', 'text-sm', 'text-xs');
            if (isMobile) {
                // ëª¨ë°”ì¼ì—ì„œëŠ” ë” ë¹¨ë¦¬ ì‘ì€ ê¸€ì”¨ë¡œ ì „í™˜
                if (messageLength > 150) {
                    previewMessage.classList.add('text-xs');
                } else if (messageLength > 80) {
                    previewMessage.classList.add('text-sm');
                } else if (messageLength > 40) {
                    previewMessage.classList.add('text-base');
                } else {
                    previewMessage.classList.add('text-base'); // ëª¨ë°”ì¼ì—ì„œëŠ” ìµœëŒ€ text-base
                }
            } else {
                // ë°ìŠ¤í¬í†±ì—ì„œëŠ” ê¸°ì¡´ ë¡œì§
                if (messageLength > 200) {
                    previewMessage.classList.add('text-xs');
                } else if (messageLength > 120) {
                    previewMessage.classList.add('text-sm');
                } else if (messageLength > 60) {
                    previewMessage.classList.add('text-base');
                } else {
                    previewMessage.classList.add('text-lg');
                }
            }
            
            // ì•½ì† í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì •
            previewPromise.classList.remove('text-base', 'text-sm', 'text-xs');
            if (isMobile) {
                if (promiseLength > 60) {
                    previewPromise.classList.add('text-xs');
                } else if (promiseLength > 30) {
                    previewPromise.classList.add('text-sm');
                } else {
                    previewPromise.classList.add('text-sm'); // ëª¨ë°”ì¼ì—ì„œëŠ” ìµœëŒ€ text-sm
                }
            } else {
                if (promiseLength > 100) {
                    previewPromise.classList.add('text-xs');
                } else if (promiseLength > 50) {
                    previewPromise.classList.add('text-sm');
                } else {
                    previewPromise.classList.add('text-base');
                }
            }
        }
        
        function applyTheme(themeClass, icon, recipientSenderClass) {
            // ê¸°ì¡´ í…Œë§ˆ í´ë˜ìŠ¤ ì œê±°
            postcardPreview.classList.remove('theme-sky', 'theme-pink', 'theme-sunshine', 'theme-forest', 'theme-ocean', 'theme-sunset');
            postcardPreview.classList.add(themeClass);
            previewThemeIcon.textContent = icon;
            
            // í…ìŠ¤íŠ¸ ìƒ‰ìƒ ì—…ë°ì´íŠ¸
            const textElements = postcardPreview.querySelectorAll('.recipient-sender-text');
            textElements.forEach(el => {
                el.classList.remove('text-sky-700', 'text-pink-700', 'text-amber-700', 'text-green-700', 'text-cyan-700', 'text-purple-700');
                el.classList.add(recipientSenderClass);
            });
            
            // í…Œë§ˆ ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.theme-option').forEach(btn => btn.classList.remove('selected'));
            document.querySelector(`[data-theme="${themeClass.replace('theme-', '')}"]`).classList.add('selected');
            
            announceToScreenReader(`${icon} í…Œë§ˆê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        }

        // ğŸ†• ì•ˆì •ì ì¸ ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ (ì™„ì „ ê°œì„ )
        async function downloadPostcardAsImage() {
            const originalText = downloadImageBtn.innerHTML;
            downloadImageBtn.innerHTML = '<span class="mr-2">â³</span>ì´ë¯¸ì§€ ìƒì„± ì¤‘...';
            downloadImageBtn.disabled = true;
            downloadImageBtn.classList.add('loading');
            
            announceToScreenReader('ì—½ì„œ ì´ë¯¸ì§€ ìƒì„±ì„ ì‹œì‘í•©ë‹ˆë‹¤.');
            
            try {
                // html2canvas ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë”© í™•ì¸
                if (typeof html2canvas === 'undefined') {
                    throw new Error('ì´ë¯¸ì§€ ìƒì„± ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
                }
                
                // ì—½ì„œ ë¯¸ë¦¬ë³´ê¸° ë‚´ìš© ì—…ë°ì´íŠ¸
                updatePostcardPreview();
                
                // ğŸ†• ì‹œìŠ¤í…œ í°íŠ¸ ì‚¬ìš©ìœ¼ë¡œ ëŒ€ê¸°ì‹œê°„ ë‹¨ì¶•
                await new Promise(resolve => setTimeout(resolve, 300));
                
                // ğŸ†• ì—˜ë¦¬ë¨¼íŠ¸ ê°€ì‹œì„± í™•ì¸
                if (!postcardPreview || postcardPreview.offsetWidth === 0) {
                    throw new Error('ì—½ì„œë¥¼ ë¨¼ì € í™•ì¸í•´ì£¼ì„¸ìš”. ë¯¸ë¦¬ë³´ê¸°ê°€ í‘œì‹œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }

                console.log('ìº¡ì²˜ ì‹œì‘ - ì—˜ë¦¬ë¨¼íŠ¸ í¬ê¸°:', postcardPreview.offsetWidth, 'x', postcardPreview.offsetHeight);

                const canvas = await html2canvas(postcardPreview, { 
                    scale: 2, // ê³ í•´ìƒë„
                    useCORS: true, 
                    allowTaint: false,
                    logging: true, // ğŸ†• ë””ë²„ê¹…ì„ ìœ„í•´ ë¡œê¹… í™œì„±í™”
                    backgroundColor: '#ffffff',
                    width: postcardPreview.offsetWidth,
                    height: postcardPreview.offsetHeight,
                    scrollX: 0,
                    scrollY: 0,
                    letterRendering: true, // ğŸ†• í…ìŠ¤íŠ¸ ë Œë”ë§ ê°œì„ 
                    imageTimeout: 15000, // ğŸ†• ì´ë¯¸ì§€ ë¡œë”© íƒ€ì„ì•„ì›ƒ
                    removeContainer: true, // ğŸ†• ì»¨í…Œì´ë„ˆ ì •ë¦¬
                    onclone: function(clonedDoc) {
                        console.log('ì—˜ë¦¬ë¨¼íŠ¸ ë³µì œ ì¤‘...');
                        
                        // ìŠ¤í¬ë¦° ë¦¬ë” ì „ìš© ìš”ì†Œ ì œê±°
                        const srOnlyElements = clonedDoc.querySelectorAll('.sr-only');
                        srOnlyElements.forEach(el => el.remove());
                        
                        // ğŸ†• í´ë¡ ëœ ì—˜ë¦¬ë¨¼íŠ¸ ìŠ¤íƒ€ì¼ ê°•í™”
                        const clonedPreview = clonedDoc.getElementById('postcardPreview');
                        if (clonedPreview) {
                            clonedPreview.style.height = 'auto';
                            clonedPreview.style.minHeight = postcardPreview.offsetHeight + 'px';
                            clonedPreview.style.overflow = 'visible';
                            clonedPreview.style.display = 'flex';
                            clonedPreview.style.flexDirection = 'column';
                            clonedPreview.style.position = 'relative';
                            
                            // ğŸ†• ì‹œìŠ¤í…œ í°íŠ¸ ê°•ì œ ì ìš© (ì›¹í°íŠ¸ ë¬¸ì œ í•´ê²°)
                            clonedPreview.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Malgun Gothic", "ë§‘ì€ ê³ ë”•", "Apple SD Gothic Neo", sans-serif';
                            
                            // ğŸ†• ëª¨ë“  í•˜ìœ„ ìš”ì†Œì—ë„ ì‹œìŠ¤í…œ í°íŠ¸ ì ìš©
                            const allElements = clonedPreview.querySelectorAll('*');
                            allElements.forEach(el => {
                                el.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Malgun Gothic", "ë§‘ì€ ê³ ë”•", "Apple SD Gothic Neo", sans-serif';
                            });
                        }
                        
                        console.log('ì—˜ë¦¬ë¨¼íŠ¸ ë³µì œ ì™„ë£Œ');
                        return clonedDoc;
                    }
                });
                
                console.log('ìº”ë²„ìŠ¤ ìƒì„± ì™„ë£Œ - í¬ê¸°:', canvas.width, 'x', canvas.height);
                
                // ğŸ†• ìº”ë²„ìŠ¤ ìœ íš¨ì„± ê²€ì‚¬
                if (canvas.width === 0 || canvas.height === 0) {
                    throw new Error('ì´ë¯¸ì§€ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì—˜ë¦¬ë¨¼íŠ¸ê°€ ì œëŒ€ë¡œ í‘œì‹œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
                }
                
                // ì´ë¯¸ì§€ ë°ì´í„° ìƒì„±
                const imgData = canvas.toDataURL('image/png', 1.0);
                
                // ğŸ†• ì´ë¯¸ì§€ ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
                if (imgData === 'data:,' || imgData.length < 100) {
                    throw new Error('ì´ë¯¸ì§€ ë°ì´í„° ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
                // íŒŒì¼ëª… ìƒì„± (ë°›ëŠ” ì‚¬ëŒ ì´ë¦„ ê¸°ë°˜)
                const recipientName = recipientInput.value || 'ê°€ì¡±';
                const fileName = `${recipientName.replace(/[^\wê°€-í£ã„±-ã…ã…-ã…£ä¸€-é¾ ã-ã‚”ã‚¡-ãƒ´ãƒ¼]/g, '_')}_ì‚¬ë‘ì—½ì„œ.png`;
                
                // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„±
                const downloadLink = document.createElement('a');
                downloadLink.href = imgData;
                downloadLink.download = fileName;
                downloadLink.style.display = 'none';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                console.log('ì´ë¯¸ì§€ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ');
                announceToScreenReader('ì—½ì„œ ì´ë¯¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                alert('ğŸ‰ ì—½ì„œ ì´ë¯¸ì§€ê°€ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\nê¸´ ë‚´ìš©ë„ ëª¨ë‘ í¬í•¨ë˜ì–´ ë‹¤ìš´ë¡œë“œ í´ë”ì— ì €ì¥ë˜ì—ˆì–´ìš”.');
                
            } catch (error) {
                console.error("ì´ë¯¸ì§€ ìƒì„± ìƒì„¸ ì˜¤ë¥˜:", error);
                
                let errorMessage = "ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.\n\n";
                
                if (error.message.includes('ë¼ì´ë¸ŒëŸ¬ë¦¬')) {
                    errorMessage += "í•´ê²° ë°©ë²•: í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ì—ì„œ ì‹œë„í•´ë³´ì„¸ìš”.";
                } else if (error.message.includes('ì—˜ë¦¬ë¨¼íŠ¸')) {
                    errorMessage += "í•´ê²° ë°©ë²•: 'ì—½ì„œ í™•ì¸í•˜ê¸°' ë²„íŠ¼ì„ ë¨¼ì € ëˆŒëŸ¬ ë¯¸ë¦¬ë³´ê¸°ë¥¼ í™•ì¸í•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.";
                } else if (error.message.includes('ë°ì´í„°')) {
                    errorMessage += "í•´ê²° ë°©ë²•: ë‚´ìš©ì„ ì¡°ê¸ˆ ìˆ˜ì •í•˜ê±°ë‚˜ ë‹¤ë¥¸ í…Œë§ˆë¥¼ ì„ íƒí•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”.";
                } else {
                    errorMessage += "í•´ê²° ë°©ë²•:\n";
                    errorMessage += "1. 'ì—½ì„œ í™•ì¸í•˜ê¸°' ë²„íŠ¼ì„ ë¨¼ì € í´ë¦­í•´ì£¼ì„¸ìš”\n";
                    errorMessage += "2. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ë³´ì„¸ìš”\n";
                    errorMessage += "3. ë‹¤ë¥¸ ë¸Œë¼ìš°ì €(Chrome, Edge ë“±)ë¥¼ ì‚¬ìš©í•´ë³´ì„¸ìš”";
                }
                
                alert(errorMessage);
                announceToScreenReader('ì´ë¯¸ì§€ ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            } finally {
                downloadImageBtn.innerHTML = originalText;
                downloadImageBtn.disabled = false;
                downloadImageBtn.classList.remove('loading');
            }
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        setTodayDate();
        updatePostcardPreview();

        updatePreviewButton.addEventListener('click', updatePostcardPreview);
        downloadImageBtn.addEventListener('click', downloadPostcardAsImage);
        
        // ğŸ†• ìƒˆë¡œìš´ í…Œë§ˆ ì„ íƒ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        themeSkyButton.addEventListener('click', () => applyTheme('theme-sky', 'â˜ï¸', 'text-sky-700'));
        themePinkButton.addEventListener('click', () => applyTheme('theme-pink', 'ğŸ’–', 'text-pink-700'));
        themeSunshineButton.addEventListener('click', () => applyTheme('theme-sunshine', 'â˜€ï¸', 'text-amber-700'));
        themeForestButton.addEventListener('click', () => applyTheme('theme-forest', 'ğŸŒ³', 'text-green-700'));
        themeOceanButton.addEventListener('click', () => applyTheme('theme-ocean', 'ğŸŒŠ', 'text-cyan-700'));
        themeSunsetButton.addEventListener('click', () => applyTheme('theme-sunset', 'ğŸŒ…', 'text-purple-700'));

        copyContentButton.addEventListener('click', () => {
            const dateValue = dateInput.value;
            let formattedDate = 'ë‚ ì§œ ë¯¸ì§€ì •';
            if (dateValue) {
                const [year, month, day] = dateValue.split('-');
                formattedDate = `${year}ë…„ ${month}ì›” ${day}ì¼`;
            }

            const contentToCopy = `
ê°€ì¡± ì‚¬ë‘ ì—½ì„œ â¤ï¸
--------------------
ë°›ëŠ” ì‚¬ëŒ: ${recipientInput.value}
ë³´ë‚´ëŠ” ì‚¬ëŒ: ${senderInput.value}
ì‘ì„± ë‚ ì§œ: ${formattedDate}

[ì‚¬ë‘ì˜ ë©”ì‹œì§€]
${messageInput.value}

[ê°€ì¡±ì„ ìœ„í•œ ë‚˜ì˜ ì•½ì†]
${promiseInput.value}
--------------------
`.trim();

            navigator.clipboard.writeText(contentToCopy)
                .then(() => {
                    alert('ì—½ì„œ ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆì–´ìš”! ì›í•˜ëŠ” ê³³ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”. (Ctrl+V ë˜ëŠ” Cmd+V)');
                    announceToScreenReader('ì—½ì„œ ë‚´ìš©ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.');
                })
                .catch(err => {
                    console.error('ë³µì‚¬ ì‹¤íŒ¨: ', err);
                    alert('ì•—! ë‚´ìš© ë³µì‚¬ì— ì‹¤íŒ¨í–ˆì–´ìš”. ë¸Œë¼ìš°ì € ì„¤ì •ì„ í™•ì¸í•˜ê±°ë‚˜ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                });
        });

        resetFormButton.addEventListener('click', () => {
            if (confirm('ì •ë§ë¡œ ëª¨ë“  ë‚´ìš©ì„ ì§€ìš°ê³  ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì‘ì„±í• ê¹Œìš”?')) {
                recipientInput.value = '';
                senderInput.value = '';
                messageInput.value = '';
                promiseInput.value = '';
                setTodayDate();
                applyTheme('theme-sky', 'â˜ï¸', 'text-sky-700');
                updatePostcardPreview();
                alert('ëª¨ë“  ë‚´ìš©ì´ ì§€ì›Œì¡Œì–´ìš”. ìƒˆë¡œìš´ ë§ˆìŒìœ¼ë¡œ ì—½ì„œë¥¼ ë‹¤ì‹œ ì‘ì„±í•´ë³´ì„¸ìš”! ğŸ˜Š');
                announceToScreenReader('ì–‘ì‹ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        });

        // ì´ˆê¸° í…Œë§ˆ ì ìš© (ê¸°ë³¸ê°’: í•˜ëŠ˜ í…Œë§ˆ)
        applyTheme('theme-sky', 'â˜ï¸', 'text-sky-700');
        
        // ğŸ†• í™”ë©´ í¬ê¸° ë³€ê²½ ì‹œ í…ìŠ¤íŠ¸ í¬ê¸° ì¬ì¡°ì •
        window.addEventListener('resize', adjustTextSizeBasedOnContent);
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì•Œë¦¼
        announceToScreenReader('ê°€ì¡± ì‚¬ë‘ ì—½ì„œ ë§Œë“¤ê¸° í˜ì´ì§€ê°€ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤. ì´ë¯¸ì§€ ìë™ ì €ì¥ ê¸°ëŠ¥ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
    </script>
</body>
</html>