<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나만의 계절 가족 사랑 엽서 만들기 🌸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Malgun Gothic", "맑은 고딕", "Apple SD Gothic Neo", sans-serif;
        }
        
        /* 계절별 엽서 테마 스타일 */
        .season-spring {
            background: linear-gradient(135deg, #fce7f3, #f3e8ff, #ecfdf5);
            border: 5px solid #f9a8d4;
        }
        .season-spring .theme-icon { color: #ec4899; }
        .season-spring .recipient-sender-text { color: #be185d; }

        .season-summer {
            background: linear-gradient(135deg, #dbeafe, #e0f2fe, #ecfeff);
            border: 5px solid #38bdf8;
        }
        .season-summer .theme-icon { color: #0284c7; }
        .season-summer .recipient-sender-text { color: #075985; }

        .season-autumn {
            background: linear-gradient(135deg, #fed7aa, #fecaca, #fef3c7);
            border: 5px solid #fb923c;
        }
        .season-autumn .theme-icon { color: #ea580c; }
        .season-autumn .recipient-sender-text { color: #c2410c; }
        
        .season-winter {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0, #f8fafc);
            border: 5px solid #94a3b8;
        }
        .season-winter .theme-icon { color: #475569; }
        .season-winter .recipient-sender-text { color: #334155; }
        
        /* 계절 선택 상태 표시 */
        .season-option.selected {
            border-color: currentColor;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        /* 🌸 봄 - 꽃잎 흩날리기 애니메이션 */
        .spring-petals {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .petal {
            position: absolute;
            width: 12px;
            height: 12px;
            background: radial-gradient(ellipse, #fce7f3, #f9a8d4);
            border-radius: 50% 0;
            opacity: 0.7;
            animation: petalFall linear infinite;
        }
        
        @keyframes petalFall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.7;
            }
            90% {
                opacity: 0.7;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* 🌊 여름 - 파도 애니메이션 */
        .summer-waves {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60px;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .wave {
            position: absolute;
            bottom: 0;
            left: -50%;
            width: 200%;
            height: 40px;
            background: linear-gradient(90deg, transparent, rgba(56, 189, 248, 0.3), transparent);
            border-radius: 50%;
            animation: waveMove linear infinite;
        }
        
        @keyframes waveMove {
            0% {
                transform: translateX(-50%) scaleY(1);
            }
            50% {
                transform: translateX(-25%) scaleY(1.2);
            }
            100% {
                transform: translateX(0%) scaleY(1);
            }
        }
        
        /* 🍂 가을 - 낙엽 떨어지기 애니메이션 */
        .autumn-leaves {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .leaf {
            position: absolute;
            font-size: 16px;
            opacity: 0.8;
            animation: leafFall linear infinite;
        }
        
        @keyframes leafFall {
            0% {
                transform: translateY(-50px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.8;
            }
            90% {
                opacity: 0.8;
            }
            100% {
                transform: translateY(100vh) rotate(180deg);
                opacity: 0;
            }
        }
        
        /* ❄️ 겨울 - 눈 내리기 애니메이션 */
        .winter-snow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
            overflow: hidden;
        }
        
        .snowflake {
            position: absolute;
            color: white;
            font-size: 14px;
            opacity: 0.9;
            animation: snowFall linear infinite;
            text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.1);
        }
        
        @keyframes snowFall {
            0% {
                transform: translateY(-50px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 0.9;
            }
            90% {
                opacity: 0.9;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        /* 엽서 콘텐츠는 애니메이션보다 위에 표시 */
        .postcard-content {
            position: relative;
            z-index: 10;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        .postcard-text-layer {
            position: relative;
            z-index: 10;
        }
        
        .loading {
            pointer-events: none;
            opacity: 0.7;
        }
        
        /* 스크린 리더 전용 텍스트 */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-gradient-to-br from-pink-100 via-purple-50 to-sky-100 flex flex-col items-center justify-center min-h-screen p-4">

    <div class="container mx-auto max-w-4xl bg-white shadow-2xl rounded-xl p-4 sm:p-6 md:p-8">
        <header class="text-center mb-6 sm:mb-8">
            <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-500 via-purple-500 to-sky-500">🌸 나만의 계절 가족 사랑 엽서 🌸</h1>
            <p class="text-slate-600 mt-2 sm:mt-3 text-sm md:text-base">소중한 가족에게 사랑하는 마음을 담아 계절의 아름다움과 함께 세상에 하나뿐인 엽서를 만들어보세요!</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6 md:gap-8">
            <div class="bg-slate-50 p-4 sm:p-6 rounded-lg shadow-md">
                <!-- 계절 테마 선택 -->
                <div class="mb-6 sm:mb-8">
                    <h2 class="text-lg sm:text-xl font-semibold text-slate-700 mb-4">🌈 계절 테마를 선택해보세요!</h2>
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                        <button id="seasonSpring" class="season-option flex flex-col items-center p-3 rounded-xl border-2 border-transparent hover:border-pink-400 transition-all duration-200 bg-pink-100" data-season="spring">
                            <span class="text-3xl mb-1">🌸</span>
                            <span class="text-sm font-medium text-pink-700">봄</span>
                            <span class="text-xs text-pink-600">꽃잎 흩날림</span>
                        </button>
                        <button id="seasonSummer" class="season-option flex flex-col items-center p-3 rounded-xl border-2 border-transparent hover:border-blue-400 transition-all duration-200 bg-blue-100" data-season="summer">
                            <span class="text-3xl mb-1">🌊</span>
                            <span class="text-sm font-medium text-blue-700">여름</span>
                            <span class="text-xs text-blue-600">파도 움직임</span>
                        </button>
                        <button id="seasonAutumn" class="season-option flex flex-col items-center p-3 rounded-xl border-2 border-transparent hover:border-orange-400 transition-all duration-200 bg-orange-100" data-season="autumn">
                            <span class="text-3xl mb-1">🍂</span>
                            <span class="text-sm font-medium text-orange-700">가을</span>
                            <span class="text-xs text-orange-600">낙엽 떨어짐</span>
                        </button>
                        <button id="seasonWinter" class="season-option flex flex-col items-center p-3 rounded-xl border-2 border-transparent hover:border-gray-400 transition-all duration-200 bg-gray-100" data-season="winter">
                            <span class="text-3xl mb-1">❄️</span>
                            <span class="text-sm font-medium text-gray-700">겨울</span>
                            <span class="text-xs text-gray-600">눈 내림</span>
                        </button>
                    </div>
                </div>

                <h3 class="text-xl sm:text-2xl font-semibold text-slate-700 mb-4 sm:mb-6">✍️ 엽서 내용 입력하기</h3>
                <div class="space-y-4">
                    <div>
                        <label for="recipient" class="block text-sm font-medium text-slate-700">💌 받는 사람:</label>
                        <input type="text" id="recipient" name="recipient" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="예: 사랑하는 엄마 아빠께">
                    </div>
                    <div>
                        <label for="sender" class="block text-sm font-medium text-slate-700">✍️ 보내는 사람:</label>
                        <input type="text" id="sender" name="sender" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="예: 귀염둥이 OOO 올림">
                    </div>
                    <div>
                        <label for="message" class="block text-sm font-medium text-slate-700">💕 사랑의 메시지:</label>
                        <textarea id="message" name="message" rows="5" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="가족에게 전하고 싶은 따뜻한 마음을 자유롭게 적어보세요."></textarea>
                    </div>
                    <div>
                        <label for="promise" class="block text-sm font-medium text-slate-700">🤝 가족을 위해 내가 꼭 실천할 약속:</label>
                        <textarea id="promise" name="promise" rows="3" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm" placeholder="예: 부모님 말씀 잘 듣고, 동생과 사이좋게 지내기"></textarea>
                    </div>
                    <div>
                        <label for="date" class="block text-sm font-medium text-slate-700">📅 작성 날짜:</label>
                        <input type="date" id="date" name="date" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-pink-500 focus:border-pink-500 sm:text-sm">
                    </div>
                </div>

                <div class="mt-6 sm:mt-8 space-y-3">
                    <button id="updatePreview" class="w-full flex items-center justify-center bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3 px-4 rounded-md shadow transition-colors duration-150 text-sm sm:text-base"><span class="mr-2 text-lg">🎨</span>엽서 확인하기</button>
                    
                    <button id="downloadImageBtn" class="w-full flex items-center justify-center bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-4 rounded-md shadow transition-colors duration-150 text-sm sm:text-base">
                        <span class="mr-2 text-lg">📸</span>엽서 이미지로 저장하기
                    </button>
                    
                    <button id="copyContent" class="w-full flex items-center justify-center bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-md shadow transition-colors duration-150 text-sm sm:text-base"><span class="mr-2 text-lg">📋</span>내용 전체 복사</button>
                    <button id="resetForm" class="w-full flex items-center justify-center bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-md shadow transition-colors duration-150 text-sm sm:text-base"><span class="mr-2 text-lg">🔄</span>새로 쓰기</button>
                </div>
                
                <!-- 상태 메시지 영역 -->
                <div id="status-messages" aria-live="polite" aria-atomic="true" class="sr-only"></div>
            </div>

            <div class="bg-slate-50 p-4 sm:p-6 rounded-lg shadow-md flex flex-col">
                <h2 class="text-xl sm:text-2xl font-semibold text-slate-700 mb-4 sm:mb-6 text-center">✨ 완성된 엽서 미리보기 ✨</h2>
                <div id="postcardPreview" class="season-spring w-full min-h-[400px] sm:min-h-[500px] p-4 sm:p-6 rounded-lg shadow-inner flex flex-col transition-all duration-300 ease-in-out relative overflow-hidden">
                    
                    <!-- 계절별 배경 애니메이션 영역들 -->
                    <div id="springPetals" class="spring-petals"></div>
                    <div id="summerWaves" class="summer-waves" style="display: none;"></div>
                    <div id="autumnLeaves" class="autumn-leaves" style="display: none;"></div>
                    <div id="winterSnow" class="winter-snow" style="display: none;"></div>
                    
                    <!-- 텍스트 레이어 (애니메이션 위에 표시) -->
                    <div class="postcard-text-layer flex flex-col h-full">
                        <div class="absolute top-2 right-2 sm:top-4 sm:right-4 text-2xl sm:text-4xl theme-icon" id="previewThemeIcon">🌸</div>
                        
                        <div class="mb-4">
                            <p class="text-sm sm:text-base recipient-sender-text">To. <span id="previewRecipient" class="font-semibold postcard-content">받는 사람 이름</span></p>
                        </div>
                        
                        <div class="text-center flex-grow py-2 px-1 relative">
                            <p id="previewMessage" class="text-slate-800 leading-relaxed postcard-content mb-3 sm:mb-4">따뜻한 사랑의 메시지를 여기에 적어주세요...</p>
                            <p id="previewPromise" class="text-indigo-600 font-medium postcard-content mb-2"></p>
                        </div>
                        
                        <div class="mt-4 text-right">
                            <p class="text-sm sm:text-base recipient-sender-text">From. <span id="previewSender" class="font-semibold postcard-content">보내는 사람 이름</span></p>
                            <p id="previewDate" class="text-xs text-slate-500 mt-1 postcard-content">날짜를 선택해주세요</p>
                        </div>
                    </div>
                </div>
                
                <!-- 사용 방법 -->
                <div class="mt-4 sm:mt-6 p-3 sm:p-4 bg-blue-50 border-l-4 border-blue-400 text-blue-700 rounded-md shadow">
                    <p class="font-semibold text-sm sm:text-base mb-2 sm:mb-3">📝 사용 방법</p>
                    <div class="space-y-1.5 sm:space-y-2 text-xs sm:text-sm">
                        <div class="flex items-center">
                            <span class="mr-2">🌸</span>
                            <strong>계절 선택:</strong> 봄(꽃잎), 여름(파도), 가을(낙엽), 겨울(눈) 중 원하는 계절 효과를 선택하세요
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2">✍️</span>
                            <strong>내용 입력:</strong> 받는 사람, 보내는 사람, 사랑의 메시지를 적어주세요
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2">🎨</span>
                            <strong>미리보기:</strong> 버튼을 클릭하여 계절 애니메이션과 함께 엽서를 확인하세요
                        </div>
                        <div class="flex items-center">
                            <span class="mr-2">📸</span>
                            <strong>저장하기:</strong> 완성된 엽서를 이미지 파일로 다운로드하세요
                        </div>
                    </div>
                    <div class="mt-3 p-2 bg-blue-100 rounded-md">
                        <p class="text-xs font-medium text-blue-800">
                            ✨ <strong>특별한 기능:</strong> 각 계절마다 고유한 배경 애니메이션이 텍스트 뒤에서 부드럽게 움직여요! 
                            글자는 선명하게 보이면서 배경에는 아름다운 자연 효과가 펼쳐집니다.
                        </p>
                    </div>
                    <p class="text-xs mt-2 sm:mt-3 text-blue-600">
                        💡 <strong>팁:</strong> 저장된 이미지는 패들렛이나 클래스팅에 바로 올릴 수 있어요!
                    </p>
                </div>
            </div>
        </div>
        
        <footer class="text-center mt-8 sm:mt-10 pt-4 sm:pt-6 border-t border-slate-200">
            <p class="text-xs sm:text-sm text-slate-500">스마트폼빌더가 정성껏 만들어 드렸어요! 🤖 | 계절별 애니메이션 + Tailwind CSS + html2canvas</p>
        </footer>
    </div>

    <script>
        // 전역 변수
        let currentSeason = 'spring';
        let animationIntervals = [];
        
        const recipientInput = document.getElementById('recipient');
        const senderInput = document.getElementById('sender');
        const messageInput = document.getElementById('message');
        const promiseInput = document.getElementById('promise');
        const dateInput = document.getElementById('date');

        const postcardPreview = document.getElementById('postcardPreview');
        const previewRecipient = document.getElementById('previewRecipient');
        const previewSender = document.getElementById('previewSender');
        const previewMessage = document.getElementById('previewMessage');
        const previewPromise = document.getElementById('previewPromise');
        const previewDate = document.getElementById('previewDate');
        const previewThemeIcon = document.getElementById('previewThemeIcon');

        const seasonSpringButton = document.getElementById('seasonSpring');
        const seasonSummerButton = document.getElementById('seasonSummer');
        const seasonAutumnButton = document.getElementById('seasonAutumn');
        const seasonWinterButton = document.getElementById('seasonWinter');
        
        const updatePreviewButton = document.getElementById('updatePreview');
        const downloadImageBtn = document.getElementById('downloadImageBtn');
        const copyContentButton = document.getElementById('copyContent');
        const resetFormButton = document.getElementById('resetForm');
        const statusMessages = document.getElementById('status-messages');

        // 애니메이션 컨테이너들
        const springPetals = document.getElementById('springPetals');
        const summerWaves = document.getElementById('summerWaves');
        const autumnLeaves = document.getElementById('autumnLeaves');
        const winterSnow = document.getElementById('winterSnow');

        // 접근성 - 스크린 리더에 메시지 전달
        function announceToScreenReader(message) {
            statusMessages.textContent = message;
            setTimeout(() => {
                statusMessages.textContent = '';
            }, 1000);
        }

        // 모든 애니메이션 정리
        function clearAllAnimations() {
            animationIntervals.forEach(interval => clearInterval(interval));
            animationIntervals = [];
            springPetals.innerHTML = '';
            summerWaves.innerHTML = '';
            autumnLeaves.innerHTML = '';
            winterSnow.innerHTML = '';
            
            // 모든 애니메이션 컨테이너 숨기기
            springPetals.style.display = 'none';
            summerWaves.style.display = 'none';
            autumnLeaves.style.display = 'none';
            winterSnow.style.display = 'none';
        }

        // 🌸 봄 - 꽃잎 흩날리기 애니메이션
        function startSpringAnimation() {
            clearAllAnimations();
            springPetals.style.display = 'block';
            
            const createPetal = () => {
                const petal = document.createElement('div');
                petal.className = 'petal';
                petal.style.left = Math.random() * 100 + '%';
                petal.style.animationDuration = (Math.random() * 3 + 4) + 's';
                petal.style.animationDelay = Math.random() * 2 + 's';
                springPetals.appendChild(petal);
                
                setTimeout(() => {
                    if (petal.parentNode) {
                        petal.parentNode.removeChild(petal);
                    }
                }, 7000);
            };
            
            // 초기 꽃잎들 생성
            for (let i = 0; i < 6; i++) {
                setTimeout(createPetal, i * 500);
            }
            
            // 지속적으로 꽃잎 생성
            const interval = setInterval(createPetal, 1500);
            animationIntervals.push(interval);
        }

        // 🌊 여름 - 파도 애니메이션
        function startSummerAnimation() {
            clearAllAnimations();
            summerWaves.style.display = 'block';
            
            const createWave = (delay) => {
                const wave = document.createElement('div');
                wave.className = 'wave';
                wave.style.animationDuration = '4s';
                wave.style.animationDelay = delay + 's';
                summerWaves.appendChild(wave);
            };
            
            // 여러 개의 파도 생성
            createWave(0);
            createWave(1);
            createWave(2);
        }

        // 🍂 가을 - 낙엽 떨어지기 애니메이션
        function startAutumnAnimation() {
            clearAllAnimations();
            autumnLeaves.style.display = 'block';
            
            const leafEmojis = ['🍂', '🍁', '🌿'];
            const leafColors = ['#ea580c', '#dc2626', '#ca8a04'];
            
            const createLeaf = () => {
                const leaf = document.createElement('div');
                leaf.className = 'leaf';
                const leafType = Math.random();
                
                if (leafType < 0.7) {
                    leaf.textContent = leafEmojis[Math.floor(Math.random() * leafEmojis.length)];
                } else {
                    leaf.innerHTML = '●';
                    leaf.style.color = leafColors[Math.floor(Math.random() * leafColors.length)];
                    leaf.style.fontSize = '12px';
                }
                
                leaf.style.left = Math.random() * 100 + '%';
                leaf.style.animationDuration = (Math.random() * 3 + 5) + 's';
                leaf.style.animationDelay = Math.random() * 2 + 's';
                autumnLeaves.appendChild(leaf);
                
                setTimeout(() => {
                    if (leaf.parentNode) {
                        leaf.parentNode.removeChild(leaf);
                    }
                }, 8000);
            };
            
            // 초기 낙엽들 생성
            for (let i = 0; i < 5; i++) {
                setTimeout(createLeaf, i * 600);
            }
            
            // 지속적으로 낙엽 생성
            const interval = setInterval(createLeaf, 2000);
            animationIntervals.push(interval);
        }

        // ❄️ 겨울 - 눈 내리기 애니메이션
        function startWinterAnimation() {
            clearAllAnimations();
            winterSnow.style.display = 'block';
            
            const snowflakeChars = ['❄', '❅', '✦', '✧', '◦'];
            
            const createSnowflake = () => {
                const snowflake = document.createElement('div');
                snowflake.className = 'snowflake';
                snowflake.textContent = snowflakeChars[Math.floor(Math.random() * snowflakeChars.length)];
                snowflake.style.left = Math.random() * 100 + '%';
                snowflake.style.fontSize = (Math.random() * 6 + 10) + 'px';
                snowflake.style.animationDuration = (Math.random() * 4 + 6) + 's';
                snowflake.style.animationDelay = Math.random() * 2 + 's';
                winterSnow.appendChild(snowflake);
                
                setTimeout(() => {
                    if (snowflake.parentNode) {
                        snowflake.parentNode.removeChild(snowflake);
                    }
                }, 10000);
            };
            
            // 초기 눈송이들 생성
            for (let i = 0; i < 8; i++) {
                setTimeout(createSnowflake, i * 400);
            }
            
            // 지속적으로 눈송이 생성
            const interval = setInterval(createSnowflake, 1200);
            animationIntervals.push(interval);
        }

        // 계절 테마 적용
        function applySeason(season) {
            currentSeason = season;
            
            // 기존 계절 클래스 제거
            postcardPreview.classList.remove('season-spring', 'season-summer', 'season-autumn', 'season-winter');
            
            // 계절별 설정
            const seasonConfigs = {
                spring: {
                    class: 'season-spring',
                    icon: '🌸',
                    textClass: 'text-pink-700',
                    animation: startSpringAnimation
                },
                summer: {
                    class: 'season-summer',
                    icon: '🌊',
                    textClass: 'text-blue-700',
                    animation: startSummerAnimation
                },
                autumn: {
                    class: 'season-autumn',
                    icon: '🍂',
                    textClass: 'text-orange-700',
                    animation: startAutumnAnimation
                },
                winter: {
                    class: 'season-winter',
                    icon: '❄️',
                    textClass: 'text-gray-700',
                    animation: startWinterAnimation
                }
            };
            
            const config = seasonConfigs[season];
            postcardPreview.classList.add(config.class);
            previewThemeIcon.textContent = config.icon;
            
            // 텍스트 색상 업데이트
            const textElements = postcardPreview.querySelectorAll('.recipient-sender-text');
            textElements.forEach(el => {
                el.classList.remove('text-pink-700', 'text-blue-700', 'text-orange-700', 'text-gray-700');
                el.classList.add(config.textClass);
            });
            
            // 계절 선택 상태 업데이트
            document.querySelectorAll('.season-option').forEach(btn => btn.classList.remove('selected'));
            document.querySelector(`[data-season="${season}"]`).classList.add('selected');
            
            // 애니메이션 시작
            config.animation();
            
            announceToScreenReader(`${config.icon} ${season} 테마가 적용되었습니다.`);
        }

        function setTodayDate() {
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            dateInput.value = `${yyyy}-${mm}-${dd}`;
        }

        function updatePostcardPreview() {
            previewRecipient.textContent = recipientInput.value || '받는 사람 이름';
            previewSender.textContent = senderInput.value || '보내는 사람 이름';
            previewMessage.textContent = messageInput.value || '따뜻한 사랑의 메시지를 여기에 적어주세요...';
            previewPromise.textContent = promiseInput.value ? `👨‍👩‍👧‍👦 실천 약속: ${promiseInput.value}` : '';
            
            const dateValue = dateInput.value;
            if (dateValue) {
                const [year, month, day] = dateValue.split('-');
                previewDate.textContent = `${year}년 ${month}월 ${day}일`;
            } else {
                previewDate.textContent = '날짜를 선택해주세요';
            }
            
            adjustTextSizeBasedOnContent();
            announceToScreenReader('엽서 내용이 업데이트되었습니다.');
        }

        function adjustTextSizeBasedOnContent() {
            const messageLength = messageInput.value.length;
            const promiseLength = promiseInput.value.length;
            const isMobile = window.innerWidth < 640;
            
            previewMessage.classList.remove('text-lg', 'text-base', 'text-sm', 'text-xs');
            if (isMobile) {
                if (messageLength > 150) {
                    previewMessage.classList.add('text-xs');
                } else if (messageLength > 80) {
                    previewMessage.classList.add('text-sm');
                } else if (messageLength > 40) {
                    previewMessage.classList.add('text-base');
                } else {
                    previewMessage.classList.add('text-base');
                }
            } else {
                if (messageLength > 200) {
                    previewMessage.classList.add('text-xs');
                } else if (messageLength > 120) {
                    previewMessage.classList.add('text-sm');
                } else if (messageLength > 60) {
                    previewMessage.classList.add('text-base');
                } else {
                    previewMessage.classList.add('text-lg');
                }
            }
            
            previewPromise.classList.remove('text-base', 'text-sm', 'text-xs');
            if (isMobile) {
                if (promiseLength > 60) {
                    previewPromise.classList.add('text-xs');
                } else if (promiseLength > 30) {
                    previewPromise.classList.add('text-sm');
                } else {
                    previewPromise.classList.add('text-sm');
                }
            } else {
                if (promiseLength > 100) {
                    previewPromise.classList.add('text-xs');
                } else if (promiseLength > 50) {
                    previewPromise.classList.add('text-sm');
                } else {
                    previewPromise.classList.add('text-base');
                }
            }
        }

        // 이미지 다운로드 기능
        async function downloadPostcardAsImage() {
            const originalText = downloadImageBtn.innerHTML;
            downloadImageBtn.innerHTML = '<span class="mr-2">⏳</span>이미지 생성 중...';
            downloadImageBtn.disabled = true;
            downloadImageBtn.classList.add('loading');
            
            announceToScreenReader('엽서 이미지 생성을 시작합니다.');
            
            try {
                if (typeof html2canvas === 'undefined') {
                    throw new Error('이미지 생성 라이브러리가 로드되지 않았습니다. 페이지를 새로고침해주세요.');
                }
                
                updatePostcardPreview();
                await new Promise(resolve => setTimeout(resolve, 500));
                
                if (!postcardPreview || postcardPreview.offsetWidth === 0) {
                    throw new Error('엽서를 먼저 확인해주세요. 미리보기가 표시되지 않았습니다.');
                }

                const canvas = await html2canvas(postcardPreview, { 
                    scale: 2,
                    useCORS: true, 
                    allowTaint: false,
                    logging: false,
                    backgroundColor: '#ffffff',
                    width: postcardPreview.offsetWidth,
                    height: postcardPreview.offsetHeight,
                    scrollX: 0,
                    scrollY: 0,
                    letterRendering: true,
                    imageTimeout: 15000,
                    removeContainer: true,
                    onclone: function(clonedDoc) {
                        const srOnlyElements = clonedDoc.querySelectorAll('.sr-only');
                        srOnlyElements.forEach(el => el.remove());
                        
                        const clonedPreview = clonedDoc.getElementById('postcardPreview');
                        if (clonedPreview) {
                            clonedPreview.style.height = 'auto';
                            clonedPreview.style.minHeight = postcardPreview.offsetHeight + 'px';
                            clonedPreview.style.overflow = 'visible';
                            clonedPreview.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Malgun Gothic", "맑은 고딕", "Apple SD Gothic Neo", sans-serif';
                            
                            const allElements = clonedPreview.querySelectorAll('*');
                            allElements.forEach(el => {
                                el.style.fontFamily = '-apple-system, BlinkMacSystemFont, "Malgun Gothic", "맑은 고딕", "Apple SD Gothic Neo", sans-serif';
                            });
                        }
                        
                        return clonedDoc;
                    }
                });
                
                if (canvas.width === 0 || canvas.height === 0) {
                    throw new Error('이미지 생성에 실패했습니다. 엘리먼트가 제대로 표시되지 않았습니다.');
                }
                
                const imgData = canvas.toDataURL('image/png', 1.0);
                
                if (imgData === 'data:,' || imgData.length < 100) {
                    throw new Error('이미지 데이터 생성에 실패했습니다.');
                }
                
                const recipientName = recipientInput.value || '가족';
                const fileName = `${recipientName.replace(/[^\w가-힣ㄱ-ㅎㅏ-ㅣ一-龠ぁ-ゔァ-ヴー]/g, '_')}_계절엽서_${currentSeason}.png`;
                
                const downloadLink = document.createElement('a');
                downloadLink.href = imgData;
                downloadLink.download = fileName;
                downloadLink.style.display = 'none';
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                
                announceToScreenReader('엽서 이미지가 성공적으로 저장되었습니다.');
                alert(`🎉 ${currentSeason} 테마 엽서 이미지가 성공적으로 저장되었습니다!\n아름다운 계절 애니메이션과 함께 다운로드 폴더에 저장되었어요.`);
                
            } catch (error) {
                console.error("이미지 생성 오류:", error);
                
                let errorMessage = "이미지 생성 중 오류가 발생했습니다.\n\n";
                
                if (error.message.includes('라이브러리')) {
                    errorMessage += "해결 방법: 페이지를 새로고침하거나 다른 브라우저에서 시도해보세요.";
                } else if (error.message.includes('엘리먼트')) {
                    errorMessage += "해결 방법: '엽서 확인하기' 버튼을 먼저 눌러 미리보기를 확인한 후 다시 시도해보세요.";
                } else {
                    errorMessage += "해결 방법:\n";
                    errorMessage += "1. '엽서 확인하기' 버튼을 먼저 클릭해주세요\n";
                    errorMessage += "2. 페이지를 새로고침한 후 다시 시도해보세요\n";
                    errorMessage += "3. 다른 브라우저(Chrome, Edge 등)를 사용해보세요";
                }
                
                alert(errorMessage);
                announceToScreenReader('이미지 생성 중 오류가 발생했습니다.');
            } finally {
                downloadImageBtn.innerHTML = originalText;
                downloadImageBtn.disabled = false;
                downloadImageBtn.classList.remove('loading');
            }
        }

        // 이벤트 리스너 등록
        setTodayDate();
        updatePostcardPreview();

        updatePreviewButton.addEventListener('click', updatePostcardPreview);
        downloadImageBtn.addEventListener('click', downloadPostcardAsImage);
        
        // 계절 선택 이벤트 리스너들
        seasonSpringButton.addEventListener('click', () => applySeason('spring'));
        seasonSummerButton.addEventListener('click', () => applySeason('summer'));
        seasonAutumnButton.addEventListener('click', () => applySeason('autumn'));
        seasonWinterButton.addEventListener('click', () => applySeason('winter'));

        copyContentButton.addEventListener('click', () => {
            const dateValue = dateInput.value;
            let formattedDate = '날짜 미지정';
            if (dateValue) {
                const [year, month, day] = dateValue.split('-');
                formattedDate = `${year}년 ${month}월 ${day}일`;
            }

            const seasonNames = {
                spring: '봄 (꽃잎 흩날림)',
                summer: '여름 (파도 움직임)',
                autumn: '가을 (낙엽 떨어짐)',
                winter: '겨울 (눈 내림)'
            };

            const contentToCopy = `
계절 가족 사랑 엽서 ❤️
--------------------
받는 사람: ${recipientInput.value}
보내는 사람: ${senderInput.value}
작성 날짜: ${formattedDate}
선택한 계절: ${seasonNames[currentSeason]}

[사랑의 메시지]
${messageInput.value}

[가족을 위한 나의 약속]
${promiseInput.value}
--------------------
`.trim();

            navigator.clipboard.writeText(contentToCopy)
                .then(() => {
                    alert('엽서 내용이 클립보드에 복사되었어요! 원하는 곳에 붙여넣기 하세요. (Ctrl+V 또는 Cmd+V)');
                    announceToScreenReader('엽서 내용이 클립보드에 복사되었습니다.');
                })
                .catch(err => {
                    console.error('복사 실패: ', err);
                    alert('앗! 내용 복사에 실패했어요. 브라우저 설정을 확인하거나 다시 시도해주세요.');
                });
        });

        resetFormButton.addEventListener('click', () => {
            if (confirm('정말로 모든 내용을 지우고 처음부터 다시 작성할까요?')) {
                recipientInput.value = '';
                senderInput.value = '';
                messageInput.value = '';
                promiseInput.value = '';
                setTodayDate();
                
                applySeason('spring');
                updatePostcardPreview();
                alert('모든 내용이 지워졌어요. 새로운 마음으로 엽서를 다시 작성해보세요! 😊');
                announceToScreenReader('양식이 초기화되었습니다.');
            }
        });

        // 초기 설정
        applySeason('spring');
        
        // 화면 크기 변경 시 텍스트 크기 재조정
        window.addEventListener('resize', adjustTextSizeBasedOnContent);
        
        // 페이지 언로드 시 애니메이션 정리
        window.addEventListener('beforeunload', clearAllAnimations);
        
        // 페이지 로드 완료 알림
        announceToScreenReader('계절별 애니메이션 가족 사랑 엽서 만들기 페이지가 로드되었습니다.');
    </script>
</body>
</html>
